<!DOCTYPE html>
<html lang="en">
<head>
     <meta name="google-site-verification" content="BoXN-_xrR1h6w0XDyEKKTVQTRIRWDhRCx9jMS2QUaYA" />

  <!-- Basic SEO -->
  <title>SNR27hub | Developer SNR | Sugam Academy Official Site</title>
  <meta name="description" content="Welcome to SNR27hub. Official website of Developer SNR, snr27, snr__27 and Sugam Academy. Explore education, projects, tutorials and creative works." />
  <meta name="keywords" content="SNR, snr27, snr__27, SNR27hub, Developer SNR, Sugam Academy, SNR website, SNR official, Developer SNR projects, Sugam Academy site" />

  <!-- Open Graph (Facebook, WhatsApp, LinkedIn Share) -->
  <meta property="og:title" content="SNR27hub | Developer SNR | Sugam Academy" />
  <meta property="og:description" content="Discover official projects, education, and resources by Developer SNR. Explore snr27, snr__27, SNR27hub, and Sugam Academy." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://snr27hub.github.io/Sugam-Academy/" />
  <meta property="og:image" content="https://snr27hub.github.io/Sugam-Academy/preview.jpg" />

  <!-- Twitter SEO -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="SNR27hub | Developer SNR | Sugam Academy" />
  <meta name="twitter:description" content="Official site of Developer SNR. Featuring snr27, snr__27, SNR27hub and Sugam Academy educational projects." />
  <meta name="twitter:image" content="https://snr27hub.github.io/Sugam-Academy/preview.jpg" />

  <!-- Mobile Friendly + Indexing -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="index, follow" />
  <link rel="canonical" href="https://snr27hub.github.io/Sugam-Academy/" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- NEW: Meta Tags for Enhanced Link Sharing -->
    <title>Sugam Academy - Premium Education Platform</title>
    <meta name="description" content="Join Sugam Academy for premium videos, notes, quizzes, and expert guidance for +2 and +3. Start your learning journey today!">
    <meta property="og:title" content="ðŸŽ“ Sugam Academy - Developed by SNR">
    <meta property="og:description" content="Join Sugam Academy for premium videos, notes, quizzes, and expert guidance for +2 and +3. Start your learning journey today!">
    <meta property="og:image" content="https://i.postimg.cc/c1YKPWds/1757931606961.jpg"> <!-- A representative image -->
    <meta property="og:url" content="https://your-website-url.com"> <!-- Replace with your actual URL -->
    <meta property="og:type" content="website">


    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cookie&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.2.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.2.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.2.0/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.2.0/firebase-database-compat.js"></script>
    <script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
    <style>
        /* General Styles and Variables */
        :root {
            --primary: #1e3a8a; /* Deep Blue */
            --secondary: #3b82f6; /* Lighter Blue */
            --accent: #f97316; /* Orange */
            --light: #f8fafc; /* Light Gray */
            --dark: #0f172a; /* Dark Blue-Gray */
            --success: #16a34a;
            --warning: #facc15;
            --danger: #ef4444;
            --bg-gradient: linear-gradient(135deg, #eef2f3 0%, #8e9eab 100%);
            --shadow-light: 0 4px 20px rgba(0, 0, 0, 0.05);
            --shadow-medium: 0 10px 30px rgba(0, 0, 0, 0.1);
            --shadow-dark: 0 15px 45px rgba(0, 0, 0, 0.2);
            --border-radius-lg: 20px;
            --border-radius-md: 12px;
            --border-radius-sm: 8px;
            --primary-rgb: 30, 58, 138; /* RGB for --primary */
            
            /* New UI/UX Colors & Gradients */
            --neon-pink: #ff00ff;
            --neon-blue: #00ffff;
            --neon-green: #00ff00;
            --neon-yellow: #ffff00;
            --neon-purple: #8a2be2;
            --premium-gradient: linear-gradient(45deg, #FFD700, #FFA500, #FFD700); /* Gold/Orange */
            --premium-text-shadow: 0 0 8px #FFD700, 0 0 15px #FFA500;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Montserrat', sans-serif; /* Default font for entire site */
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            /* Animated multi-color neon gradient background for the body itself */
            background: linear-gradient(135deg, #1e3a8a, #8a2be2, #3b82f6, #00ff00); /* Deep blue to purple, then light blue, then green */
            background-size: 300% 300%;
            animation: neonGradientBody 20s ease infinite alternate;
            color: var(--dark); /* Keep text readable */
            min-height: 100vh;
            line-height: 1.6;
            overflow-x: hidden;
            padding-top: 7.5rem;
        }
        @keyframes neonGradientBody {
            0% { background-position: 0% 0%; }
            50% { background-position: 100% 100%; }
            100% { background-position: 0% 0%; }
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1.5rem;
        }
        
        /* Utility Classes */
        .text-center { text-align: center; }
        .my-5 { margin: 5rem 0; }
        .py-5 { padding: 5rem 0; }
        .rounded-lg { border-radius: var(--border-radius-lg); }
        .rounded-md { border-radius: var(--border-radius-md); }
        .shadow-md { box-shadow: var(--shadow-medium); }

        /* Developer Info (REMOVED from top, integrated into logo) */
        .dev-info {
            display: none; /* Hide the old "Developed by SNR" */
        }

        /* Header Styles */
        header {
            background: linear-gradient(135deg, var(--neon-pink), var(--neon-blue), var(--neon-green), var(--neon-yellow)); /* Neon multicolour gradient */
            background-size: 300% 300%;
            animation: neonGradientHeader 15s ease infinite alternate; /* Animated gradient */
            backdrop-filter: blur(12px); /* Stronger blur */
            padding: 1rem 0;
            box-shadow: 0 4px 25px rgba(0, 0, 0, 0.08); /* More pronounced shadow */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            transition: all 0.3s ease;
        }
        @keyframes neonGradientHeader {
            0% { background-position: 0% 0%; }
            50% { background-position: 100% 100%; }
            100% { background-position: 0% 0%; }
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }

        /* Logo with Developer Link */
        .logo {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 0.2rem;
            /* Removed color here, will be applied to child span with gradient */
            font-family: 'Playfair Display', serif;
            font-size: 1.8rem; /* Base font size */
            font-weight: 700;
            text-decoration: none;
            transition: all 0.3s ease;
        }
        .logo:hover {
            /* Keep this hover effect for general logo area */
        }
        .logo .main-logo-line {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        /* Targeting the "Sugam Academy" text specifically for gradient */
        .logo .main-logo-line span {
            font-size: 1.8rem; /* Ensure consistent font size for the text part */
            font-weight: 700;
            
            /* Apply neon gradient to text */
            background: linear-gradient(45deg, var(--neon-pink), var(--neon-blue), var(--neon-green), var(--neon-yellow));
            background-size: 300% 100%; /* Wider for animation */
            -webkit-background-clip: text; /* Clip background to text shape */
            -webkit-text-fill-color: transparent; /* Make text color transparent */
            background-clip: text; /* Standard property */
            color: transparent; /* Fallback for browsers */
            text-shadow: 0 0 5px rgba(255, 0, 255, 0.4); /* Subtle initial glow for readability */
            animation: logoNeonGradientShift 4s linear infinite alternate;
            transition: text-shadow 0.3s ease;
        }
        .logo .main-logo-line span:hover {
            text-shadow: 0 0 15px var(--neon-blue), 0 0 25px var(--neon-pink); /* Stronger glow on hover */
        }
        @keyframes logoNeonGradientShift {
            0% { background-position: 0% 0%; }
            100% { background-position: 100% 0%; }
        }

        .logo i {
            font-size: 1.5rem;
            color: var(--primary); /* Keep icon solid blue */
            transition: color 0.3s ease;
        }
        .logo:hover i {
            color: var(--secondary); /* Icon color on hover */
        }

        .developer-logo-text {
            font-size: 0.8rem;
            font-weight: 500;
            font-family: 'Montserrat', sans-serif;
            align-self: flex-start;
            margin-left: 0.5rem;
            margin-bottom: -0.4rem;

            /* Apply neon gradient to entire "Developer: SNR" */
            background: linear-gradient(45deg, var(--neon-yellow), var(--neon-green), var(--neon-blue), var(--neon-pink));
            background-size: 300% 100%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 5px rgba(255, 255, 0, 0.4); /* Subtle glow */
            animation: logoNeonGradientShift 4s linear infinite alternate; /* Reuse animation */
            transition: text-shadow 0.3s ease;
        }
        .developer-logo-text:hover {
            text-shadow: 0 0 15px var(--neon-green), 0 0 25px var(--neon-yellow); /* Stronger glow on hover */
        }

        .developer-logo-text a {
            color: transparent; /* Ensure gradient applies to link text */
            text-decoration: none;
            transition: all 0.3s ease-in-out;
            position: relative;
            display: inline-block;
            text-shadow: none; /* Remove previous shadow as parent handles it */
            animation: none; /* Remove previous animation as parent handles it */
        }
        .developer-logo-text a:hover {
            text-decoration: underline;
        }

        /* Style for the new developer badge */
        .developer-verified-badge {
            width: 14px;
            height: 14px;
            vertical-align: middle;
            margin-left: 4px;
            display: inline-block;
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 2rem;
        }

        nav a {
            color: var(--dark);
            text-decoration: none;
            font-weight: 600; /* Bolder */
            padding: 0.5rem 0;
            position: relative;
            transition: color 0.3s ease, transform 0.2s ease;
            text-shadow: 0 0 2px rgba(0,0,0,0.1);
        }

        nav a:after {
            content: '';
            position: absolute;
            left: 0;
            bottom: 0;
            width: 0;
            height: 2px;
            background-color: var(--neon-pink); /* Neon pink underline */
            transition: width 0.3s ease;
        }

        nav a:hover:after {
            width: 100%;
        }
        nav a:hover {
            color: var(--neon-blue); /* Neon blue on hover */
            transform: translateY(-2px);
            text-shadow: 0 0 8px var(--neon-blue);
        }

        .auth-buttons {
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        
        .user-authenticated-controls {
            display: none;
            align-items: center;
            gap: 1rem;
        }

        .notification-bell {
            position: relative;
            cursor: pointer;
            color: var(--dark);
            font-size: 1.25rem;
            transition: color 0.3s ease, transform 0.2s ease;
        }
        
        .notification-bell:hover {
            color: var(--accent);
            transform: scale(1.1);
        }

        .notification-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--accent);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 600;
            animation: pulseNotification 2s infinite ease-out;
        }
        @keyframes pulseNotification {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(249, 115, 22, 0.7); }
            70% { transform: scale(1.1); box-shadow: 0 0 0 10px rgba(249, 115, 22, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(249, 115, 22, 0); }
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 9999px;
            border: 2px solid transparent;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease, transform 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(45deg, var(--primary), var(--secondary)); /* Gradient background */
            color: white;
            border-color: var(--primary);
            box-shadow: 0 0 10px rgba(var(--primary-rgb), 0.5), 0 0 20px rgba(var(--primary-rgb), 0.3); /* Initial glow */
            animation: buttonGlowPrimary 2s infinite alternate;
        }
        .btn-primary:hover {
            background: linear-gradient(45deg, var(--neon-blue), var(--neon-pink)); /* Neon gradient on hover */
            border-color: var(--neon-blue);
            box-shadow: 0 0 15px var(--neon-blue), 0 0 30px var(--neon-pink);
            transform: translateY(-3px) scale(1.02);
            animation: none; /* Stop pulse on hover for responsiveness */
        }
        @keyframes buttonGlowPrimary {
            0% { box-shadow: 0 0 10px rgba(var(--primary-rgb), 0.5); }
            100% { box-shadow: 0 0 15px rgba(var(--primary-rgb), 0.7); }
        }

        .btn-outline {
            background: transparent;
            border-color: var(--dark);
            color: var(--dark);
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
        }
        .btn-outline:hover {
            background: var(--dark);
            color: var(--neon-green); /* Neon green text on hover */
            border-color: var(--neon-green);
            box-shadow: 0 0 10px var(--neon-green), 0 0 20px rgba(0, 255, 0, 0.4);
            transform: translateY(-2px);
        }
        
        #profileMenuToggleBtn {
            background-color: transparent;
            border-color: var(--primary);
            color: var(--primary);
            padding: 0.75rem;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            border-radius: var(--border-radius-lg);
        }
        #profileMenuToggleBtn:hover {
            background-color: var(--primary);
            color: white;
            box-shadow: 0 4px 15px rgba(30, 58, 138, 0.3);
            transform: translateY(-2px);
        }

        /* Profile Dropdown Menu */
        .profile-dropdown-menu {
            position: absolute;
            top: 5rem;
            right: 1.5rem;
            background: white;
            border-radius: var(--border-radius-md);
            box-shadow: var(--shadow-medium);
            width: 250px;
            padding: 1rem;
            z-index: 1000;
            animation: modalFadeIn 0.3s ease-out;
            border: 1px solid #e2e8f0;
        }
        .profile-dropdown-menu ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .profile-dropdown-menu li {
            padding: 0.5rem 0;
            color: var(--dark);
            font-weight: 500;
            line-height: 1.2;
        }
        .profile-dropdown-menu li a {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: var(--dark);
            text-decoration: none;
            transition: color 0.3s ease, transform 0.2s ease;
        }
        .profile-dropdown-menu li a:hover {
            color: var(--primary);
            transform: translateX(5px);
        }
        .profile-dropdown-menu li a i {
            font-size: 1.1rem;
            color: var(--secondary);
        }
        .profile-dropdown-menu strong {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--primary);
            display: block;
            margin-bottom: 0.2rem;
            text-shadow: 0 0 5px rgba(30, 58, 138, 0.2);
        }
        .profile-dropdown-menu span#dropdownPremiumStatus {
            font-size: 0.9rem;
            color: #64748b;
            display: block;
            margin-top: -0.2rem;
        }
        .profile-dropdown-menu .menu-separator {
            border-top: 1px solid #e2e8f0;
            margin: 1rem 0;
            padding: 0;
        }
        .profile-dropdown-menu .btn {
            margin-top: 0.5rem;
        }
        .verified-badge-img {
            width: 18px; /* Adjusted size for icon */
            height: 18px;
            vertical-align: middle; /* Align with text */
            margin-left: 0.5rem;
            display: inline-block;
            /* No animation */
        }

        /* Hero Section */
        .hero {
            position: relative;
            padding: 0;
            color: white;
            text-align: center;
            overflow: hidden;
            /* Animated base background for hero */
            background: linear-gradient(135deg, #1e3a8a, #8a2be2, #3b82f6, #00ff00); /* Deep blue to purple, then light blue, then green */
            background-size: 300% 300%;
            animation: neonGradientBody 20s ease infinite alternate; /* Reuse body animation */
            display: flex; 
            align-items: center; 
            justify-content: center; 
            min-height: 350px; /* Increased min-height */
            flex-direction: column;
            gap: 1.5rem;
            flex-grow: 1;
        }

        /* Dynamic Hero Background */
        .hero-dynamic-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center center;
            transition: background-image 1s ease-in-out, filter 1s ease-in-out; /* Smooth transition for background image and filter */
            filter: brightness(0.6) blur(8px); /* Darken and blur the background */
            z-index: 0; /* Behind other hero content */
            opacity: 0.8;
            /* Animated neon gradient overlay */
            background-image: linear-gradient(45deg, rgba(255,0,255,0.3), rgba(0,255,255,0.3), rgba(0,255,0,0.3), rgba(255,255,0,0.3)), var(--initial-bg-image, none);
            background-size: 400% 400%, cover;
            background-position: 0% 0%, center center;
            animation: gradientShiftBgOverlay 15s linear infinite;
            background-attachment: fixed; /* Optional: parallax effect */
        }
        @keyframes gradientShiftBgOverlay {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .hero::before { /* Removed static overlay, using dynamic bg with filter */
            display: none;
        }

        .hero-content {
            position: relative;
            z-index: 2;
            width: 100%;
            max-width: 1200px;
            padding: 0 1.5rem;
            height: auto;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        /* Banner Slider */
        .banner-slider-container {
            width: 100%;
            max-width: 100%;
            position: relative;
            overflow: hidden;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3); /* More prominent shadow */
            /* Animated multi-color neon gradient for container background */
            background: linear-gradient(45deg, var(--neon-pink), var(--neon-blue), var(--neon-green), var(--neon-yellow)); 
            background-size: 400% 400%;
            animation: gradientShift 10s ease infinite;
            border: 2px solid transparent; /* No solid border now, gradient takes over */
            box-shadow: 0 0 25px var(--neon-pink), 0 0 50px var(--neon-blue); /* Neon outer glow */
            border-radius: var(--border-radius-md);
            flex-grow: 1;
            margin-top: 2rem;
            aspect-ratio: 16 / 9; /* Fixed aspect ratio for stability */
            max-height: 700px; /* Max height to prevent excessively tall banners */
            min-height: 300px;
        }
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .banner-slider {
            display: flex;
            transition: transform 0.7s cubic-bezier(0.2, 0.8, 0.2, 1); /* Smoother animation */
            width: 100%;
            height: 100%; /* Fill container's aspect ratio height */
        }
        
        .banner-slide {
            min-width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
        }
        
        .banner-slide img {
            width: 100%;
            height: 100%;
            object-fit: contain; /* Show full image, might letterbox */
            background-color: rgba(0, 0, 0, 0.3); /* Dark background for letterbox areas */
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
        }

        #currentBannerButtonWrapper {
            background: var(--premium-gradient); /* Premium gradient for button wrapper */
            color: var(--dark);
            padding: 0.7rem 1.8rem; /* Larger padding */
            border-radius: 9999px;
            margin-top: 1.5rem;
            box-shadow: 0 0 15px var(--accent), 0 0 25px rgba(249, 115, 22, 0.5); /* Glowing effect */
            animation: gradientBorderPulse 3s infinite alternate;
        }
        @keyframes gradientBorderPulse {
            0% { box-shadow: 0 0 10px var(--accent), 0 0 20px rgba(249, 115, 22, 0.4); }
            50% { box-shadow: 0 0 20px var(--accent), 0 0 35px rgba(249, 115, 22, 0.6); }
            100% { box-shadow: 0 0 10px var(--accent), 0 0 20px rgba(249, 115, 22, 0.4); }
        }

        #currentBannerButtonWrapper .btn-primary {
            background: transparent; /* Transparent button to show gradient background */
            border-color: white; /* White border for contrast */
            color: white;
            text-shadow: var(--premium-text-shadow);
            padding: 0.8rem 2rem; /* Larger button */
            transition: all 0.3s ease;
        }
        #currentBannerButtonWrapper .btn-primary:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--neon-blue);
            box-shadow: 0 0 15px var(--neon-blue), 0 0 25px var(--neon-pink);
            transform: scale(1.05);
        }

        .slider-controls button {
            background: rgba(0, 0, 0, 0.6);
            color: white;
            border: none;
            padding: 0.6rem; /* Larger buttons */
            font-size: 1.8rem; /* Larger icons */
            width: 40px;
            height: 40px;
            border-radius: 50%;
            transition: background 0.3s ease, transform 0.2s ease;
        }

        .slider-controls button:hover {
            background: var(--accent);
            transform: scale(1.1);
        }

        /* Dynamic User Notification Bar */
        .user-notification-bar {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(var(--primary-rgb), 0.95);
            color: white;
            padding: 0.9rem 1.8rem; /* Larger padding */
            border-radius: var(--border-radius-lg);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
            z-index: 1500;
            font-size: 1rem; /* Slightly larger font */
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
            min-width: 320px;
            max-width: 90%;
            text-align: center;
            pointer-events: none;
            border: 1px solid rgba(255, 255, 255, 0.2);
            text-shadow: 0 0 5px rgba(0,0,0,0.5);
        }
        .user-notification-bar span {
            font-weight: 700;
            margin: 0 0.3rem; /* More space */
            color: var(--accent); /* Highlight names/counts */
        }
        .user-notification-bar.show {
            opacity: 1;
            pointer-events: auto;
            transform: translateX(-50%) translateY(-10px); /* Lift slightly on show */
        }
        /* Specific animations for user count/name (used within this bar) */
        @keyframes userCountFade {
            0% { opacity: 0; transform: translateY(-5px); }
            50% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(5px); }
        }
        @keyframes userNameSwap {
            0% { opacity: 0; transform: translateX(-10px); }
            50% { opacity: 1; transform: translateX(0); }
            100% { opacity: 0; transform: translateX(10px); }
        }
        .fade-in-out { animation: userCountFade 1s forwards; }
        .slide-in-out { animation: userNameSwap 1s forwards; }
        
        /* Section Title */
        .section-title {
            text-align: center;
            margin-bottom: 4.5rem; /* More space */
        }

        .section-title h2 {
            font-family: 'Playfair Display', serif;
            font-size: clamp(2.2rem, 5vw, 3.2rem); /* Larger titles */
            /* Gradient text with neon effect */
            background: linear-gradient(45deg, var(--primary), var(--neon-blue), var(--neon-pink), var(--neon-green));
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 10px rgba(30, 58, 138, 0.5); /* Soft glow */
            animation: textNeonPulse 3s infinite alternate;
            position: relative;
            display: inline-block;
        }
        @keyframes textNeonPulse {
            0% { text-shadow: 0 0 5px rgba(30, 58, 138, 0.5), 0 0 10px rgba(0, 255, 255, 0.2); }
            100% { text-shadow: 0 0 15px rgba(30, 58, 138, 0.7), 0 0 25px rgba(0, 255, 255, 0.4); }
        }
        .section-title h2:after {
            content: '';
            display: block;
            width: 70%; /* Wider underline */
            height: 3px;
            /* Multi-color neon gradient for underline */
            background: linear-gradient(90deg, var(--neon-pink), var(--neon-green), var(--neon-blue), var(--neon-yellow));
            background-size: 200% 100%;
            margin: 0.8rem auto 0;
            border-radius: 2px;
            animation: gradientUnderlineShift 4s linear infinite, expandUnderline 3s infinite alternate;
        }
        @keyframes gradientUnderlineShift {
            0% { background-position: 0% 0%; }
            100% { background-position: 200% 0%; }
        }
        @keyframes expandUnderline {
            0% { width: 50%; opacity: 0.7; }
            100% { width: 80%; opacity: 1; }
        }

        /* NEW: Top Scorer Display */
        .top-scorer-banner {
            text-align: center;
            background: linear-gradient(45deg, var(--neon-purple), var(--dark));
            color: white;
            padding: 1rem;
            margin-bottom: 2rem;
            border-radius: var(--border-radius-md);
            box-shadow: 0 0 20px var(--neon-purple);
            animation: fadeIn 1s ease;
            transition: opacity 0.5s ease-out;
        }
        .top-scorer-banner p {
            font-size: 1.2rem;
            font-weight: 600;
            text-shadow: 0 0 10px var(--neon-yellow);
        }
        .top-scorer-banner span {
            color: var(--neon-yellow);
            font-family: 'Playfair Display', serif;
        }

        /* Content Sections */
        .content-section {
            margin-bottom: 6rem;
        }

        .content-section.active {
            display: block;
        }
        
        /* NEW: Category (+2/+3) Selector Styles */
        .category-selector {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2.5rem;
        }
        .category-selector .btn {
            background: #fff;
            color: var(--primary);
            border: 2px solid var(--primary);
            font-weight: 700;
            box-shadow: none;
            animation: none;
        }
        .category-selector .btn:hover {
            background: #eef2f3;
            transform: translateY(-2px);
        }
        .category-selector .btn.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 0 15px rgba(var(--primary-rgb), 0.5);
            transform: scale(1.05);
        }

        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 2rem; /* Larger gap */
        }

        .content-card {
            background: white;
            border-radius: var(--border-radius-md);
            overflow: hidden;
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.08); /* Stronger shadow */
            transition: all 0.3s cubic-bezier(0.2, 0.8, 0.2, 1); /* Smoother animation */
            border: 1px solid rgba(var(--primary-rgb), 0.1); /* Subtle initial border */
             /* PERFORMANCE: Hint to browser for hardware acceleration */
            transform: translateZ(0);
        }

        .content-card:hover {
            transform: translateY(-8px) scale(1.01) translateZ(0); /* Keep hardware accel hint */
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2), 0 0 25px var(--neon-blue); /* Neon glow shadow */
            border-color: var(--neon-blue); /* Neon border on hover */
        }

        .content-thumb {
            height: 200px;
            position: relative;
            overflow: hidden;
            background: linear-gradient(135deg, var(--primary), var(--neon-blue)); /* Gradient background with neon blue */
        }
        /* For gallery specific thumb gradient */
        .gallery-section .content-card .content-thumb {
            background: linear-gradient(135deg, var(--neon-blue), var(--neon-pink)); /* Neon gradient for gallery thumbs */
        }

        .content-thumb img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }

        .content-card:hover .content-thumb img {
            transform: scale(1.08);
        }

        .content-thumb i {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3.5rem; /* Larger icons */
            color: white;
            text-shadow: 0 3px 15px rgba(0, 0, 0, 0.6);
            opacity: 0.9;
            transition: all 0.3s ease;
        }
        .content-card:hover .content-thumb i {
            color: var(--neon-green); /* Neon green icon on hover */
            text-shadow: 0 0 15px var(--neon-green), 0 0 25px rgba(0, 255, 0, 0.5);
            transform: translate(-50%, -50%) scale(1.1);
        }

        .content-info {
            padding: 1.5rem;
        }

        .content-info h3 {
            font-size: 1.35rem; /* Slightly larger */
            margin-bottom: 0.5rem;
            color: var(--dark);
        }

        .premium-badge {
            background: var(--accent);
            color: white;
            padding: 0.25rem 0.85rem; /* Larger padding */
            border-radius: 9999px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-left: 0.5rem;
            box-shadow: 0 2px 10px rgba(249, 115, 22, 0.3);
            animation: badgePulse 2s infinite alternate;
        }
        @keyframes badgePulse {
            0% { transform: scale(1); opacity: 0.9; }
            50% { transform: scale(1.03); opacity: 1; }
            100% { transform: scale(1); opacity: 0.9; }
        }

        .favorite-btn {
            background: none;
            border: none;
            color: #ccc;
            cursor: pointer;
            font-size: 1.4rem; /* Larger heart */
            margin-left: auto;
            transition: color 0.3s ease, transform 0.2s ease;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        .favorite-btn.favorited {
            color: var(--danger);
            animation: heartBeat 1s; /* Animation for a single beat */
        }
        .favorite-btn:hover {
            color: var(--danger);
            transform: scale(1.2);
        }
        @keyframes heartBeat {
            0% { transform: scale(1); }
            14% { transform: scale(1.1); }
            28% { transform: scale(1); }
            42% { transform: scale(1.1); }
            70% { transform: scale(1); }
        }

        /* Teachers Section */
        .teachers {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); /* Larger cards */
            gap: 2.5rem;
            margin-bottom: 6rem;
        }

        .teacher-card {
            background: white;
            border-radius: var(--border-radius-lg);
            overflow: hidden;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
            transition: all 0.4s cubic-bezier(0.2, 0.8, 0.2, 1.2);
            text-align: center;
            border: 1px solid rgba(var(--primary-rgb), 0.1);
            transform: translateZ(0); /* PERFORMANCE: Hardware accel hint */
        }

        .teacher-card:hover {
            transform: translateY(-12px) scale(1.02) translateZ(0);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2), 0 0 25px var(--neon-pink); /* Neon glow shadow */
            border-color: var(--neon-pink); /* Neon border on hover */
        }

        .teacher-img {
            position: relative;
            height: 220px; /* Taller images */
            background: linear-gradient(135deg, var(--neon-purple), var(--neon-pink)); /* New gradient */
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            overflow: hidden;
        }

        /* Teacher image slider */
        .teacher-image-slider {
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        .teacher-image-slider .slide {
            width: 100%;
            height: 100%;
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .teacher-image-slider .slide.active {
            display: block;
        }
        
        .teacher-image-slider img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: grayscale(0.2); /* Slight grayscale */
            transition: filter 0.3s ease;
        }
        .teacher-card:hover .teacher-image-slider img {
            filter: grayscale(0); /* Full color on hover */
        }
        
        .teacher-info {
            padding: 1.5rem;
        }

        .teacher-info h3 {
            font-family: 'Playfair Display', serif;
            font-size: 1.6rem; /* Larger */
            color: var(--dark);
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .teacher-info p {
            color: #64748b;
            font-size: 0.95rem;
        }

        /* Footer */
        footer {
            /* Animated multi-color background for footer */
            background: linear-gradient(135deg, var(--dark), #2c3e50, var(--dark)); /* Darker base with subtle gradient */
            background-size: 200% 200%;
            animation: footerBgShift 12s ease infinite alternate;
            color: white;
            padding: 4rem 0 2rem;
            margin-top: 6rem;
            box-shadow: inset 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        @keyframes footerBgShift {
            0% { background-position: 0% 0%; }
            100% { background-position: 100% 100%; }
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); /* Adjust grid */
            gap: 2.5rem;
            margin-bottom: 2rem;
        }

        .footer-section h3 {
            font-family: 'Playfair Display', serif;
            font-size: 1.6rem;
            margin-bottom: 1.5rem;
            position: relative;
            color: var(--neon-blue); /* Neon blue title */
            text-shadow: 0 0 8px var(--neon-blue), 0 0 15px rgba(0, 255, 255, 0.4);
        }

        .footer-section h3:after {
            content: '';
            display: block;
            width: 60px;
            height: 2px;
            /* Multi-color neon for footer underline */
            background: linear-gradient(90deg, var(--neon-pink), var(--neon-yellow));
            background-size: 200% 100%;
            margin-top: 0.5rem;
            animation: footerUnderline 2s infinite alternate, gradientUnderlineShift 3s linear infinite reverse; /* Combine animations */
        }
        .footer-section p {
            margin-bottom: 0.6rem;
            color: #e2e8f0;
            font-size: 0.95rem;
        }
        .footer-section p span {
            color: var(--neon-blue);
            text-shadow: 0 0 5px var(--neon-blue);
        }

        .footer-section a {
            color: #e2e8f0;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .footer-section a:hover {
            color: var(--secondary);
        }

        .social-links {
            display: flex;
            gap: 1.2rem; /* Wider gap */
            margin-top: 1.5rem;
        }

        .social-links a {
            color: white;
            font-size: 1.8rem; /* Larger icons */
            transition: color 0.3s ease, transform 0.3s ease;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
        }

        .social-links a:hover {
            color: var(--neon-green); /* Neon green on hover for social icons */
            text-shadow: 0 0 10px var(--neon-green), 0 0 15px var(--neon-yellow);
            transform: translateY(-5px) scale(1.1);
        }

        .footer-bottom {
            text-align: center;
            padding-top: 2rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.9rem;
            color: #cbd5e1;
        }

        /* Auth Modals (Combined) */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            overflow-y: auto; /* Allow scrolling for long modals */
        }

        .modal-content {
            background: white;
            border-radius: var(--border-radius-lg);
            padding: 2.5rem;
            width: 90%;
            max-width: 500px; /* Slightly wider modal */
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5), 0 0 30px var(--neon-blue); /* Neon glow on modals */
            position: relative;
            animation: modalFadeIn 0.5s cubic-bezier(0.2, 0.8, 0.2, 1.2);
            border: 1px solid rgba(0, 255, 255, 0.3); /* Subtle neon border */
            margin: 2rem 0;
        }
        /* Make modal content scrollable, not the whole page */
        #myPurchasesModal .modal-content, #myFavoritesModal .modal-content {
            max-height: 80vh;
            display: flex;
            flex-direction: column;
        }
        .modal-body {
            overflow-y: auto;
        }

        .close-modal {
            position: absolute;
            top: 1rem;
            right: 1.25rem;
            font-size: 1.8rem; /* Larger close icon */
            cursor: pointer;
            color: var(--dark);
            transition: transform 0.3s ease, color 0.3s ease;
        }
        
        .close-modal:hover {
            transform: rotate(90deg) scale(1.1);
            color: var(--danger);
        }

        .auth-form h2 {
            font-family: 'Playfair Display', serif;
            text-align: center;
            margin-bottom: 1.5rem;
            color: var(--primary);
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        /* Tabs for Login/Register within the modal */
        .auth-tabs {
            display: flex;
            margin-bottom: 1.5rem;
            border-radius: var(--border-radius-sm) var(--border-radius-sm) 0 0;
            overflow: hidden;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        .auth-tabs button {
            flex: 1;
            padding: 0.9rem; /* Taller tabs */
            border: none; /* Removed individual borders */
            background-color: #f1f5f9;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #64748b;
            font-size: 1rem;
            letter-spacing: 0.5px;
        }
        .auth-tabs button.active {
            background-color: var(--primary);
            color: white;
            box-shadow: 0 0 15px var(--primary), 0 0 25px rgba(30, 58, 138, 0.5); /* Stronger premium glow */
            text-shadow: var(--premium-text-shadow);
        }
        .auth-tabs button:not(.active):hover {
            background-color: #e2e8f0;
            color: var(--dark);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.6rem; /* More space */
            font-weight: 600; /* Bolder label */
            color: var(--dark);
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 0.9rem 1.2rem; /* Larger inputs */
            border: 1px solid #cbd5e1;
            border-radius: var(--border-radius-sm);
            font-size: 1rem;
            transition: all 0.3s ease;
            background-color: #fdfdfd;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            border-color: var(--secondary);
            box-shadow: 0 0 0 4px rgba(var(--primary-rgb), 0.25); /* Stronger focus ring */
            outline: none;
        }

        .form-options {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            font-size: 0.95rem;
        }
        .form-options a {
            color: var(--secondary);
            text-decoration: none;
            transition: color 0.3s ease;
        }
        .form-options a:hover {
            color: var(--primary);
            text-decoration: underline;
        }

        /* Animations (Keep them global as they are reused or specifically scoped) */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-30px) scale(0.9); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-50px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeOut {
            from { opacity: 1; transform: translateY(0) scale(1); }
            to { opacity: 0; transform: translateY(20px) scale(0.9); }
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(0, 149, 246, 0.3);
            border-radius: 50%;
            border-top-color: #0095f6;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive Design */
        @media (max-width: 992px) {
            nav { display: none; }
            .header-content { flex-wrap: wrap; justify-content: center; gap: 1rem; }
            .auth-buttons { width: 100%; justify-content: center; margin-top: 1rem; }
            .hero { padding: 1.5rem 0; min-height: 200px; }
            .banner-slider-container { height: clamp(120px, 18vw, 250px); } /* Revert height clamp for smaller screens */
            #currentBannerButtonWrapper { margin-top: 1rem; }
        }

        @media (max-width: 768px) {
            .container { padding: 0 1rem; }
            .section-title h2 { font-size: 2rem; }
            .modal-content { padding: 1.5rem; }
            .logo .developer-logo-text { margin-left: 0; text-align: center; width: 100%; }
            .logo { align-items: center; }
            body { padding-top: 8.5rem; }
            header { padding: 0.5rem 0; }
            .profile-dropdown-menu { top: 4.5rem; right: 0.5rem; }
            .user-notification-bar { min-width: unset; max-width: 95%; padding: 0.6rem 1rem; font-size: 0.85rem;}
        }

        /* Admin Panel Styles */
        .admin-panel {
            display: none;
            padding: 2rem 0;
            background: #f1f5f9;
        }

        .admin-header {
            background: var(--dark);
            color: white;
            padding: 1.5rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: var(--border-radius-md) var(--border-radius-md) 0 0;
        }

        .admin-header .btn-outline {
            background: transparent;
            border-color: #cbd5e1;
            color: white;
        }

        .admin-header .btn-outline:hover {
            background: white;
            color: var(--dark);
        }

        .admin-nav {
            background: var(--dark);
            padding: 0 2rem;
            display: flex;
            gap: 1.5rem;
            flex-wrap: wrap;
            border-bottom: 1px solid #1e293b;
        }

        .admin-nav a {
            color: #cbd5e1;
            text-decoration: none;
            padding: 1rem 0;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .admin-nav a:hover, .admin-nav a.active {
            color: white;
            border-color: var(--secondary);
        }

        .admin-content {
            background: white;
            padding: 2rem;
            border-radius: 0 0 var(--border-radius-md) var(--border-radius-md);
            box-shadow: var(--shadow-medium);
            min-height: 500px;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2.5rem;
        }

        .stat-card {
            background: #f8fafc;
            border-radius: var(--border-radius-md);
            padding: 1.5rem;
            box-shadow: var(--shadow-light);
            text-align: center;
            border: 1px solid #e2e8f0;
        }

        .stat-number {
            font-family: 'Playfair Display', serif;
            font-size: 3rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        .admin-section {
            display: none;
        }

        .admin-section.active {
            display: block;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 2rem 0;
        }

        .data-table th, .data-table td {
            padding: 1rem 1.25rem;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        .data-table th {
            background: var(--primary);
            color: white;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.9rem;
        }

        .data-table tr:hover {
            background: #f8fafc;
        }
        
        .notification-bell {
            position: relative;
            cursor: pointer;
            color: var(--dark);
            font-size: 1.25rem;
            transition: color 0.3s ease;
        }
        
        .notification-bell:hover {
            color: var(--secondary);
        }

        .notification-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--accent);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .add-form {
            background: #f8fafc;
            padding: 1.5rem;
            border-radius: var(--border-radius-md);
            margin-bottom: 1.5rem;
            border: 1px solid #e2e8f0;
        }
        
        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }

        /* Tab Navigation for Content Sections */
        .content-tabs {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .tab-link {
            padding: 0.75rem 1.5rem;
            border-radius: 9999px;
            background: #e2e8f0;
            color: var(--dark);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tab-link:hover, .tab-link.active {
            background: var(--primary);
            color: white;
        }

        /* Enhanced Premium Modal Styles */
        .premium-plans {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }
        
        .plan-card {
            background: #e2e8f0;
            border: 2px solid transparent;
            border-radius: var(--border-radius-md);
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .plan-card:hover, .plan-card.selected {
            border-color: var(--primary);
            background: var(--primary);
            color: white;
        }

        .plan-card h4 {
            font-weight: 600;
            font-size: 0.9rem;
            margin: 0;
        }
        
        .plan-card p {
            font-size: 1.25rem;
            font-weight: 700;
            margin-top: 0.25rem;
        }
        
        /* New Payment Section Styles */
        .payment-card {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: var(--border-radius-md);
            padding: 1rem;
            text-align: center;
            box-shadow: var(--shadow-light);
            margin-top: 1.5rem;
        }

        .payment-card h3 {
            font-family: 'Playfair Display', serif;
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
            color: var(--primary);
        }

        /* NEW: Translated Payment Notice */
        .payment-notice {
            text-align: center;
            margin-bottom: 1rem;
            color: var(--danger);
            font-weight: 600;
            font-size: 0.7rem; /* Extremely small text */
        }
        .payment-notice .lang-en,
        .payment-notice .lang-or {
            display: none;
        }
        html[lang="en"] .payment-notice .lang-en,
        body:not([lang]) .payment-notice .lang-en { /* Fallback to english */
            display: inline;
        }
        html[lang="or"] .payment-notice .lang-or {
            display: inline;
        }


        .qr-container {
            margin-bottom: 0.5rem;
        }

        .qr-container img {
            width: 120px;
            height: 120px;
            border-radius: var(--border-radius-sm);
            border: 2px solid var(--primary);
        }

        .upi-info {
            background: #fff;
            padding: 0.5rem;
            border-radius: var(--border-radius-sm);
            border: 1px solid #ddd;
            margin-bottom: 0.5rem;
        }

        .upi-info p {
            margin: 0;
            font-weight: 500;
            font-size: 0.8rem;
        }

        .upi-id {
            color: var(--primary);
            font-weight: 700;
            margin-top: 0.25rem;
        }

        .form-group {
            margin-bottom: 0.75rem;
        }

        .form-group label {
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
        }

        .form-group input {
            padding: 0.5rem 0.75rem;
            font-size: 0.9rem;
        }
        
        /* Payment Status Badges */
        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-pending {
            background-color: var(--warning);
            color: var(--dark);
        }

        .status-verified, .status-successful {
            background-color: var(--success);
            color: white;
        }

        .status-rejected {
            background-color: var(--danger);
            color: white;
        }

        /* Instagram Popup specific styles (Scoped to avoid conflicts) */
        #instagramPopupModal .modal-content {
            background: transparent;
            box-shadow: none;
            padding: 0;
            max-width: 380px;
            overflow: visible;
        }

        #instagramPopupModal .instagram-close {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 1.8rem; 
            color: white; 
            text-shadow: 0 0 5px var(--neon-pink), 0 0 10px var(--neon-blue); /* Neon glow for close button */
            cursor: pointer;
            transition: transform 0.2s ease, color 0.3s ease;
            z-index: 100;
        }

        #instagramPopupModal .instagram-close:hover {
            transform: rotate(90deg) scale(1.1);
            color: var(--neon-blue);
        }

        #instagramPopupModal .popup-container {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            position: relative;
            width: 100%;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 16px;
            box-shadow: 0 0 25px var(--neon-pink), 
                        0 0 50px var(--neon-blue),
                        0 0 75px rgba(255, 0, 255, 0.3);
            overflow: hidden;
            animation: fadeIn 0.8s ease-out, neonBorder 4s infinite alternate;
            border: 1px solid transparent;
            z-index: 2;
            margin: 0;
            padding: 0;
        }
        
        #instagramPopupModal .popup-container::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            z-index: -1;
            background: linear-gradient(45deg, var(--neon-pink), var(--neon-blue), var(--neon-pink), var(--neon-blue), var(--neon-pink));
            background-size: 400%;
            border-radius: 18px;
            animation: neonGradient 8s linear infinite;
        }
        
        #instagramPopupModal .header {
            position: relative;
            padding: 20px;
            text-align: center;
            background: linear-gradient(90deg, #fdf497, #fd5949, #d6249f, #285AEB); /* Instagram gradient colors */
            color: white;
            overflow: hidden;
        }
        
        #instagramPopupModal .header h2 {
            font-weight: 600;
            letter-spacing: 1px;
            font-size: 18px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            position: relative;
            z-index: 2;
        }
        
        #instagramPopupModal .light-animation {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #833ab4, #fd1d1d, #fcb045, #833ab4);
            background-size: 300% 100%;
            animation: gradientMove 3s infinite linear;
        }
        
        #instagramPopupModal .profile-content {
            padding: 20px;
            text-align: center;
            position: relative;
            z-index: 2;
        }
        
        #instagramPopupModal .profile-img {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid transparent;
            box-shadow: 0 0 20px var(--neon-pink);
            margin: 0 auto 15px;
            animation: neonPulse 3s infinite alternate;
            position: relative;
            z-index: 2;
        }
        
        #instagramPopupModal .username {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #ffffff;
            text-shadow: 0 0 10px var(--neon-pink);
            animation: textGlow 2s infinite alternate;
        }
        
        #instagramPopupModal .stats {
            display: flex;
            justify-content: center;
            margin-bottom: 25px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            animation: statPulse 4s infinite alternate;
            position: relative;
            z-index: 2;
        }
        
        #instagramPopupModal .stat {
            text-align: center;
            padding: 0 25px;
        }
        
        #instagramPopupModal .stat-value {
            font-size: 18px;
            font-weight: 700;
            color: #ffffff;
            text-shadow: 0 0 8px var(--neon-blue);
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        #instagramPopupModal .stat-label {
            font-size: 14px;
            color: #cccccc;
        }

        #instagramPopupModal .follow-btn {
            display: block;
            width: 100%;
            padding: 12px;
            background: linear-gradient(45deg, var(--neon-pink), var(--neon-blue));
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            margin-bottom: 15px;
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: 0 0 15px var(--neon-pink);
            position: relative;
            overflow: hidden;
            z-index: 2;
        }
        
        #instagramPopupModal .follow-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 0 20px var(--neon-pink), 0 0 30px var(--neon-blue);
        }
        
        #instagramPopupModal .follow-btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, var(--neon-blue), var(--neon-pink));
            z-index: -1;
            transition: opacity 0.3s;
            opacity: 0;
        }
        
        #instagramPopupModal .follow-btn:hover::after {
            opacity: 1;
        }
        
        #instagramPopupModal .close-btn {
            display: block;
            width: 100%;
            padding: 12px;
            background: transparent;
            color: var(--neon-blue);
            border: 1px solid var(--neon-blue);
            border-radius: 8px;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.4);
            text-shadow: 0 0 5px rgba(0, 255, 255, 0.6);
            position: relative;
            z-index: 2;
        }
        
        #instagramPopupModal .close-btn:hover {
            background: rgba(0, 255, 255, 0.15);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.7);
        }
        
        #instagramPopupModal .developer-text {
            text-align: center;
            margin-top: 20px;
            font-size: 16px;
            color: var(--neon-blue);
            text-shadow: 0 0 10px var(--neon-blue);
            animation: glow 2s infinite alternate;
            font-weight: 600;
            letter-spacing: 1px;
            position: relative;
            z-index: 2;
        }
        
        /* Particles background */
        #instagramPopupModal .particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            overflow: hidden;
        }
        
        #instagramPopupModal .particle {
            position: absolute;
            background: rgba(255, 0, 255, 0.6);
            border-radius: 50%;
            animation: float 6s infinite ease-in-out;
        }
        
        /* Animations */
        @keyframes glow {
            from { text-shadow: 0 0 5px var(--neon-blue), 0 0 10px var(--neon-blue); }
            to { text-shadow: 0 0 15px var(--neon-blue), 0 0 25px var(--neon-blue), 0 0 35px var(--neon-blue); }
        }
        
        @keyframes textGlow {
            from { text-shadow: 0 0 5px var(--neon-pink); }
            to { text-shadow: 0 0 15px var(--neon-pink), 0 0 25px var(--neon-pink); }
        }
        
        @keyframes gradientMove {
            0% { background-position: 0% 50%; }
            100% { background-position: 300% 50%; }
        }
        
        @keyframes neonBorder {
            0% { box-shadow: 0 0 20px var(--neon-pink), 0 0 40px var(--neon-blue); }
            50% { box-shadow: 0 0 25px var(--neon-pink), 0 0 50px var(--neon-blue), 0 0 70px rgba(255, 0, 255, 0.4); }
            100% { box-shadow: 0 0 30px var(--neon-pink), 0 0 60px var(--neon-blue); }
        }
        
        @keyframes neonGradient {
            0% { background-position: 0% 50%; filter: blur(5px); }
            50% { background-position: 100% 50%; filter: blur(8px); }
            100% { background-position: 0% 50%; filter: blur(5px); }
        }
        
        @keyframes neonPulse {
            0% { box-shadow: 0 0 10px var(--neon-pink), 0 0 20px var(--neon-blue); }
            50% { box-shadow: 0 0 20px var(--neon-pink), 0 0 40px var(--neon-blue); }
            100% { box-shadow: 0 0 15px var(--neon-pink), 0 0 30px var(--neon-blue), 0 0 45px rgba(255, 0, 255, 0.4); }
        }
        
        @keyframes statPulse {
            0% { box-shadow: inset 0 0 10px var(--neon-pink); }
            50% { box-shadow: inset 0 0 15px var(--neon-blue); }
            100% { box-shadow: inset 0 0 12px var(--neon-pink); }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0) translateX(0) rotate(0deg); opacity: 0.7; }
            25% { transform: translateY(-20px) translateX(10px) rotate(5deg); opacity: 0.9; }
            50% { transform: translateY(-40px) translateX(-10px) rotate(-5deg); opacity: 0.6; }
            75% { transform: translateY(-20px) translateX(10px) rotate(5deg); opacity: 0.8; }
        }
        
        #instagramPopupModal .instagram-logo {
            font-family: 'Cookie', cursive;
            font-size: 28px;
            margin-bottom: 5px;
            display: inline-block;
        }
        
        #instagramPopupModal .pulse-circle {
            position: absolute;
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: rgba(255, 0, 255, 0.2);
            z-index: 1;
            animation: pulse 4s infinite ease-in-out;
        }
        
        @keyframes pulse {
            0% { transform: scale(0.8); opacity: 0.5; }
            50% { transform: scale(1.2); opacity: 0.2; }
            100% { transform: scale(0.8); opacity: 0.5; }
        }

        /* Quiz Modal Styles */
        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .quiz-option {
            display: flex;
            align-items: center;
            background: #f1f5f9;
            padding: 0.75rem 1rem;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .quiz-option:hover {
            background: #e2e8f0;
        }
        .quiz-option input[type="radio"] {
            margin-right: 0.75rem;
            accent-color: var(--primary);
        }
        .quiz-feedback {
            margin-top: 1.5rem;
            padding: 1rem;
            border-radius: var(--border-radius-md);
            font-weight: 600;
            text-align: center;
            animation: feedbackGlow 1s forwards ease-out;
            display: none;
        }
        .quiz-feedback.correct {
            background-color: rgba(22, 163, 74, 0.1);
            color: var(--success);
            border: 1px solid var(--success);
        }
        .quiz-feedback.incorrect {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--danger);
            border: 1px solid var(--danger);
        }
        @keyframes feedbackGlow {
            0% { opacity: 0; transform: scale(0.8); box-shadow: 0 0 0 rgba(0,0,0,0); }
            50% { opacity: 1; transform: scale(1.05); }
            100% { opacity: 1; transform: scale(1); }
        }
        @keyframes correctGlow {
            0% { box-shadow: 0 0 5px var(--success); }
            50% { box-shadow: 0 0 20px var(--success), 0 0 30px rgba(22, 163, 74, 0.5); }
            100% { box-shadow: 0 0 5px var(--success); }
        }
        @keyframes incorrectGlow {
            0% { box-shadow: 0 0 5px var(--danger); }
            50% { box-shadow: 0 0 20px var(--danger), 0 0 30px rgba(239, 68, 68, 0.5); }
            100% { box-shadow: 0 0 5px var(--danger); }
        }

        /* Content Display Modal */
        #contentDisplayModal .modal-content {
            max-width: 900px;
            width: 95%;
            height: 90%;
            padding: 1rem;
            display: flex;
            flex-direction: column;
        }
        #contentDisplayModal .modal-content h2 {
            margin-bottom: 0.5rem;
            font-size: 1.8rem;
        }
        #contentDisplayModal .content-iframe-wrapper {
            flex-grow: 1;
            position: relative;
            background: #f1f5f9;
            border-radius: var(--border-radius-sm);
            overflow: hidden;
            border: 1px solid #e2e8f0;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.05);
            display: flex; 
            align-items: center;
            justify-content: center;
        }
        #contentDisplayModal iframe,
        #contentDisplayModal img,
        #contentDisplayModal video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
            object-fit: contain; /* Use contain for images/videos to ensure full visibility */
        }
        /* Fallback message styling */
        #contentDisplayModal .fallback-content {
            padding: 2rem;
            text-align: center;
        }
        #contentDisplayModal .fallback-content h4 {
            font-family: 'Playfair Display', serif;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        /* Gallery Section Specific Styles */
        .gallery-section .content-grid .content-thumb {
            background: linear-gradient(135deg, var(--neon-blue), var(--neon-pink)); /* Neon gradient for gallery thumbs */
        }
        .gallery-section .content-card:hover .content-thumb i {
            color: white;
            text-shadow: 0 0 10px var(--neon-blue), 0 0 15px var(--neon-pink);
        }

        /* Language Selector Styles */
        .language-selector {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-left: 1rem;
        }

        .language-selector select {
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius-sm);
            border: 2px solid var(--neon-blue); /* Neon border */
            background: transparent; /* Transparent background */
            color: var(--dark); /* Dark text for readability */
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.4);
        }

        .language-selector select:hover {
            box-shadow: 0 0 15px var(--neon-blue), 0 0 25px var(--neon-pink);
        }
        /* Style the dropdown options */
        .language-selector select option {
            background: white;
            color: var(--dark);
        }

        #google_translate_element {
            display: none; /* Hidden as we control via select */
        }

        /* NEW: Floating Chat System Styles */
        .chat-fab {
            position: fixed;
            bottom: 25px;
            right: 25px;
            width: 60px;
            height: 60px;
            background: linear-gradient(45deg, var(--neon-blue), var(--neon-pink));
            border-radius: 50%;
            display: none; /* Hidden by default, shown for logged-in users */
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: white;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3), 0 0 20px var(--neon-blue);
            cursor: pointer;
            z-index: 1050;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            animation: fabPulse 2s infinite;
        }
        .chat-fab:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(0,0,0,0.4), 0 0 30px var(--neon-pink);
            animation-play-state: paused;
        }
        @keyframes fabPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .chat-widget {
            position: fixed;
            bottom: 100px;
            right: 25px;
            width: 350px;
            max-width: 90vw;
            height: 500px;
            max-height: 70vh;
            background: white;
            border-radius: var(--border-radius-md);
            box-shadow: var(--shadow-dark);
            z-index: 1049;
            display: none; /* Hidden by default */
            flex-direction: column;
            overflow: hidden;
            transform-origin: bottom right;
            animation: chatWidgetOpen 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes chatWidgetOpen {
            from { transform: scale(0); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .chat-widget-header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 1rem;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .chat-widget-header .close-chat {
            cursor: pointer;
            font-size: 1.2rem;
            opacity: 0.8;
            transition: opacity 0.2s ease;
        }
        .chat-widget-header .close-chat:hover {
            opacity: 1;
        }

        .chat-messages {
            flex-grow: 1;
            padding: 1rem;
            overflow-y: auto;
            background-color: #f1f5f9;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        .chat-message {
            max-width: 80%;
            padding: 0.6rem 1rem;
            border-radius: var(--border-radius-md);
            line-height: 1.4;
        }
        .chat-message.user {
            background-color: var(--secondary);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 4px;
        }
        .chat-message.admin {
            background-color: #e2e8f0;
            color: var(--dark);
            align-self: flex-start;
            border-bottom-left-radius: 4px;
        }
        .chat-message-time {
            font-size: 0.7rem;
            color: #94a3b8;
            margin-top: 4px;
            text-align: right;
        }
        .chat-message.admin .chat-message-time {
            color: #64748b;
        }

        .chat-input-form {
            display: flex;
            padding: 0.75rem;
            border-top: 1px solid #e2e8f0;
        }
        .chat-input-form input {
            flex-grow: 1;
            border: 1px solid #cbd5e1;
            padding: 0.6rem;
            border-radius: var(--border-radius-sm);
            margin-right: 0.5rem;
        }
        .chat-input-form button {
            background: var(--primary);
            color: white;
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
        }

        /* NEW: Admin Chat Styles */
        .admin-chat-layout {
            display: flex;
            gap: 1.5rem;
            min-height: 600px;
        }
        .admin-chat-list {
            width: 30%;
            border: 1px solid #e2e8f0;
            border-radius: var(--border-radius-md);
            overflow-y: auto;
        }
        .admin-chat-list-item {
            padding: 1rem;
            border-bottom: 1px solid #e2e8f0;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        .admin-chat-list-item:hover, .admin-chat-list-item.active {
            background-color: #f1f5f9;
        }
        .admin-chat-list-item strong {
            display: block;
            color: var(--primary);
        }
        .admin-chat-list-item span {
            font-size: 0.8rem;
            color: #64748b;
        }
        .admin-chat-window {
            width: 70%;
            border: 1px solid #e2e8f0;
            border-radius: var(--border-radius-md);
            display: flex;
            flex-direction: column;
        }
        .admin-chat-window-placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #94a3b8;
            font-size: 1.2rem;
        }

        /* NEW: Notification Toast Styles (Image & Text) */
        .notification-toast-container {
            position: fixed;
            top: 90px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .notification-toast {
            background: white;
            border-radius: var(--border-radius-md);
            box-shadow: var(--shadow-dark);
            width: 380px;
            max-width: 90vw;
            display: flex;
            align-items: flex-start;
            padding: 1rem;
            gap: 1rem;
            opacity: 0;
            transform: translateX(100%);
            transition: transform 0.5s ease-in-out, opacity 0.5s ease-in-out;
        }
        .notification-toast.show {
            opacity: 1;
            transform: translateX(0);
        }
        .notification-toast img {
            width: 80px;
            height: 80px;
            border-radius: var(--border-radius-sm);
            object-fit: cover;
            flex-shrink: 0;
        }
        /* Style for text-only toasts */
         .notification-toast.text-only .toast-icon {
            font-size: 1.5rem;
            color: var(--primary);
            padding-top: 0.2rem;
        }

        .notification-toast-content {
            flex-grow: 1;
        }
        .notification-toast-content h4 {
            margin: 0 0 0.5rem 0;
            color: var(--primary);
        }
        .notification-toast-content p {
            margin: 0;
            font-size: 0.9rem;
            color: var(--dark);
        }
        .toast-close-btn {
            position: absolute;
            top: 5px;
            right: 10px;
            background: none;
            border: none;
            font-size: 1.2rem;
            color: #94a3b8;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <header>
        <div class="container header-content">
            <a href="#" class="logo" id="mainLogo">
                <span class="developer-logo-text">
                    Developer: <a href="https://www.instagram.com/snr__27?igsh=MXI4YXd5NnIxMDAzcw==" target="_blank">SNR <img src="https://i.postimg.cc/02bVmN0y/badge.png" alt="Verified" class="developer-verified-badge"></a>
                </span>
                <div class="main-logo-line">
                    <i class="fas fa-graduation-cap"></i>
                    <span>Sugam Academy</span>
                </div>
            </a>
            <nav>
                <ul>
                    <li><a href="#home">Home</a></li>
                    <li><a href="#content" class="tab-link" data-tab="videos">Videos</a></li>
                    <li><a href="#content" class="tab-link" data-tab="notes">Notes</a></li>
                    <li><a href="#content" class="tab-link" data-tab="quizzes">Quizzes</a></li>
                    <li><a href="#gallery" class="tab-link" data-tab="gallery">Gallery</a></li>
                    <li><a href="#premium">Premium</a></li>
                    <li><a href="#teachers">Teachers</a></li>
                </ul>
            </nav>
            <div class="auth-buttons">
                <!-- Language Selector -->
                <div class="language-selector">
                    <select id="languageSelect">
                        <option value="en">English</option>
                        <option value="or">Odia</option>
                        <option value="hi">Hindi</option>
                        <option value="bn">Bengali</option>
                        <option value="te">Telugu</option>
                        <option value="ta">Tamil</option>
                    </select>
                </div>
                <!-- Login/Register button for logged out users -->
                <button class="btn btn-primary" id="loginRegisterBtn"><i class="fas fa-sign-in-alt"></i> Login / Register</button>
                
                <!-- Authenticated user controls -->
                <div class="user-authenticated-controls" style="display: none;">
                    <div class="notification-bell" id="notificationBell">
                        <i class="fas fa-bell"></i>
                        <span class="notification-count" id="notificationCount">0</span>
                    </div>
                    <!-- Hamburger menu button for logged-in users -->
                    <button class="btn btn-outline" id="profileMenuToggleBtn"><i class="fas fa-bars"></i></button>
                </div>

                <!-- Profile Dropdown Menu for logged-in users -->
                <div class="profile-dropdown-menu" id="profileDropdownMenu" style="display: none;">
                    <ul>
                        <li><strong><span id="dropdownUserName"></span> <img src="https://i.postimg.cc/02bVmN0y/badge.png" alt="Verified" class="verified-badge-img" id="dropdownVerifiedBadge" style="display:none;"></strong></li>
                        <li><span id="dropdownPremiumStatus"></span></li>
                        <li class="menu-separator"></li>
                        <li><a href="#" id="myPurchasesLink"><i class="fas fa-shopping-bag"></i> My Purchases</a></li>
                        <li><a href="#" id="myFavoritesLink"><i class="fas fa-heart"></i> My Favorites</a></li>
                        <li><a href="#" id="getVerifiedBadgeLink"><i class="fas fa-shield-alt"></i> Get Verified Badge</a></li>
                        <li><a href="#" id="viewNotificationsLink"><i class="fas fa-bell"></i> Notifications (<span id="dropdownNotificationCount">0</span>)</a></li>
                        <li class="menu-separator"></li>
                        <li><button class="btn btn-primary" id="dropdownGoPremiumBtn" style="width: 100%; display: none;"><i class="fas fa-crown"></i> Go Premium</button></li>
                        <li><button class="btn btn-outline" id="dropdownLogoutBtn" style="width: 100%;"><i class="fas fa-sign-out-alt"></i> Logout</button></li>
                    </ul>
                </div>
            </div>
        </div>
    </header>
    
    <section class="hero" id="home">
        <div class="hero-dynamic-bg" id="heroDynamicBg"></div> <!-- Dynamic background layer -->
        <div class="container hero-content">
            <!-- Banner Slider will be placed here -->
            <div class="banner-slider-container">
                <div class="banner-slider" id="bannerSlider"></div>
                <div class="slider-controls">
                    <button id="prevBtn"><i class="fas fa-chevron-left"></i></button>
                    <button id="nextBtn"><i class="fas fa-chevron-right"></i></button>
                </div>
            </div>
            <!-- Button Wrapper below the banner slider -->
            <div class="banner-button-wrapper" id="currentBannerButtonWrapper">
                <!-- Dynamic button will be placed here by JS -->
            </div>
        </div>
    </section>

    <section class="container" id="content" style="display:none;">
        <div class="section-title"><h2>Learning Resources</h2></div>
        <!-- NEW: Top Scorer Display Area -->
        <div class="top-scorer-banner" id="topScorerBanner" style="display: none;"></div>

        <!-- NEW: +2 / +3 Category Selector -->
        <div class="category-selector" id="categorySelector">
            <button class="btn active" data-category="+2">+2 Section</button>
            <button class="btn" data-category="+3">+3 Section</button>
        </div>

        <div class="content-tabs">
            <div class="tab-link active" data-tab="videos">Videos</div>
            <div class="tab-link" data-tab="notes">Notes</div>
            <div class="tab-link" data-tab="quizzes">Quizzes</div>
        </div>
        <div class="content-section active" id="videos">
            <div class="content-grid" id="videoContentGrid"></div>
        </div>
        <div class="content-section" id="notes" style="display: none;">
            <div class="content-grid" id="notesContentGrid"></div>
        </div>
        <div class="content-section" id="quizzes" style="display: none;">
            <div class="content-grid" id="quizContentGrid"></div>
        </div>
    </section>

    <section class="container py-5 gallery-section" id="gallery"> <!-- New Gallery Section -->
        <div class="section-title"><h2>Our Gallery</h2></div>
        <div class="content-grid" id="galleryContentGrid"></div>
    </section>

    <section class="container py-5" id="teachers">
        <div class="section-title"><h2>Our Expert Teachers</h2></div>
        <div class="teachers" id="teachersContainer"></div>
    </section>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>About Us</h3>
                    <p id="footerAboutUsText"></p>
                </div>
                <div class="footer-section">
                    <h3>Contact Us</h3>
                    <p>Email: <span id="footerSugamEmail"></span></p>
                    <p>Developer Email: <span id="footerDeveloperEmail"></span></p>
                    <div class="social-links">
                        <a href="#" target="_blank" id="footerYoutubeLink"><i class="fab fa-youtube"></i></a>
                        <a href="#" target="_blank" id="footerInstagramLink"><i class="fab fa-instagram"></i></a>
                        <a href="#" target="_blank" id="footerFacebookLink"><i class="fab fa-facebook"></i></a>
                        <a href="#" target="_blank" id="footerTwitterLink"><i class="fab fa-twitter"></i></a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Sugam Academy. Developed by SNR. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Combined Auth Modal -->
    <div class="modal" id="authModal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <div class="auth-tabs">
                <button id="showLoginTab" class="active">Login</button>
                <button id="showRegisterTab">Register</button>
            </div>
            
            <div class="auth-form" id="loginFormContainer">
                <h2>Login to Your Account</h2>
                <form id="loginForm">
                    <div class="form-group">
                        <label for="loginEmail">Email</label>
                        <input type="email" id="loginEmail" placeholder="Enter your email" required>
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Password</label>
                        <input type="password" id="loginPassword" placeholder="Enter your password" required>
                    </div>
                    <div class="form-options">
                        <label>
                            <input type="checkbox"> Remember me
                        </label>
                        <a href="#" id="forgotPassword">Forgot Password?</a>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Login</button>
                </form>
            </div>

            <div class="auth-form" id="registerFormContainer" style="display: none;">
                <h2>Create an Account</h2>
                <form id="registerForm">
                    <div class="form-group">
                        <label for="registerName">Full Name</label>
                        <input type="text" id="registerName" placeholder="Enter your full name" required>
                    </div>
                    <div class="form-group">
                        <label for="registerEmail">Email</label>
                        <input type="email" id="registerEmail" placeholder="Enter your email" required>
                    </div>
                    <div class="form-group">
                        <label for="registerPassword">Password</label>
                        <input type="password" id="registerPassword" placeholder="Create a password" required>
                    </div>
                    <div class="form-group">
                        <label for="registerConfirmPassword">Confirm Password</label>
                        <input type="password" id="registerConfirmPassword" placeholder="Confirm your password" required>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Register</button>
                </form>
            </div>
        </div>
    </div>
    <!-- End Combined Auth Modal -->

    <div class="modal" id="premiumModal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <div class="auth-form">
                <h2>Upgrade to Premium</h2>
                <!-- Plan selection removed -->
                <div id="premiumPaymentSection">
                    <!-- NEW: Translated Payment Notice -->
                    <p class="payment-notice">
                        <span class="lang-en">Enter the 12-digit UTR number after payment for successful verification.</span>
                        <span class="lang-or">à¬ªà­‡à¬®à­‡à¬£à­à¬Ÿ à¬ªà¬°à­‡ à¬¸à¬«à¬³ à¬¯à¬¾à¬žà­à¬š à¬ªà¬¾à¬‡à¬ 12-à¬…à¬™à­à¬• à¬¬à¬¿à¬¶à¬¿à¬·à­à¬Ÿ UTR à¬¨à¬®à­à¬¬à¬° à¬¦à¬¿à¬…à¬¨à­à¬¤à­à¥¤</span>
                    </p>
                    <div class="payment-card">
                        <p style="font-size: 0.9rem; margin-bottom: 0.5rem;">Pay using any UPI app</p>
                        <div class="qr-container">
                            <img src="https://i.postimg.cc/Kvwrx7JJ/Picsart-25-09-15-23-25-43-793.png" alt="UPI QR Code">
                        </div>
                        <p style="font-size: 0.9rem; margin-bottom: 0.5rem;">Or pay via UPI ID</p>
                        <div class="upi-info">
                            <p>Amount: <span style="font-weight: 700;">â‚¹<span id="displayPremiumAmount">0</span></span></p>
                            <p>UPI ID: <span class="upi-id">mrperfect11457@oksbi</span></p>
                        </div>
                        <div class="form-group">
                            <label for="UTRNumber">After payment, enter 12-digit UTR number</label>
                            <input type="text" id="UTRNumber" placeholder="Enter 12-digit UTR" required>
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: 100%;" onclick="submitPaymentDetails('premium')">Submit</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Video Buy Modal (Used for video and now for verify badge) -->
    <div class="modal" id="videoBuyModal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <div class="auth-form">
                <h2 id="buyModalTitle"></h2>
                
                <div id="itemPaymentSection">
                    <!-- NEW: Translated Payment Notice -->
                    <p class="payment-notice">
                        <span class="lang-en">Enter the 12-digit UTR number after payment for successful verification.</span>
                        <span class="lang-or">à¬ªà­‡à¬®à­‡à¬£à­à¬Ÿ à¬ªà¬°à­‡ à¬¸à¬«à¬³ à¬¯à¬¾à¬žà­à¬š à¬ªà¬¾à¬‡à¬ 12-à¬…à¬™à­à¬• à¬¬à¬¿à¬¶à¬¿à¬·à­à¬Ÿ UTR à¬¨à¬®à­à¬¬à¬° à¬¦à¬¿à¬…à¬¨à­à¬¤à­à¥¤</span>
                    </p>
                    <div class="payment-card">
                        <p style="font-size: 0.9rem; margin-bottom: 0.5rem;">Pay using any UPI app</p>
                        <div class="qr-container">
                            <img src="https://i.postimg.cc/Kvwrx7JJ/Picsart-25-09-15-23-25-43-793.png" alt="UPI QR Code">
                        </div>
                        <p style="font-size: 0.9rem; margin-bottom: 0.5rem;">Or pay via UPI ID</p>
                        <div class="upi-info">
                            <p>Amount: <span style="font-weight: 700;">â‚¹<span id="itemPriceToBuy">0</span></span></p>
                            <p>UPI ID: <span class="upi-id">mrperfect11457@oksbi</span></p>
                        </div>
                        <div class="form-group">
                            <label for="itemUTRNumber">After payment, enter 12-digit UTR number</label>
                            <input type="text" id="itemUTRNumber" placeholder="Enter 12-digit UTR" required>
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: 100%;" onclick="submitPaymentDetails(currentPaymentType)">Submit</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quiz Modal -->
    <div class="modal" id="quizModal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2 id="quizModalTitle"></h2>
            <div id="quizQuestionContainer">
                <p id="quizQuestionText" style="font-size: 1.2rem; margin-bottom: 1.5rem; font-weight: 600;"></p>
                <div class="quiz-options" id="quizOptions">
                    <!-- Options will be dynamically loaded here -->
                </div>
                <button class="btn btn-primary" id="submitQuizAnswerBtn" style="width: 100%;">Submit Answer</button>
            </div>
            <div class="quiz-feedback" id="quizFeedback">
                <!-- Feedback message and animation will appear here -->
            </div>
            <button class="btn btn-outline" id="closeQuizFeedbackBtn" style="width: 100%; margin-top: 1rem; display: none;">Close Quiz</button>
        </div>
    </div>

    <!-- Content Display Modal -->
    <div class="modal" id="contentDisplayModal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2 id="contentDisplayModalTitle"></h2>
            <div class="content-iframe-wrapper">
                <!-- Content (iframe, img, video) will be loaded here -->
            </div>
        </div>
    </div>

    <!-- NEW: My Favorites Modal -->
    <div class="modal" id="myFavoritesModal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>My Favorites</h2>
            <div class="modal-body" id="favoritesModalBody">
                <div class="content-grid" id="favoritesContentGrid">
                    <!-- Favorited content will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- NEW: My Purchases Modal -->
    <div class="modal" id="myPurchasesModal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>My Purchases</h2>
            <div class="modal-body" id="purchasesModalBody">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Item</th>
                            <th>Amount</th>
                            <th>Date</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="purchasesTableBody">
                        <!-- Purchase history will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>


    <!-- Instagram Popup Modal -->
    <div class="modal" id="instagramPopupModal">
        <div class="modal-content">
            <span class="close-modal instagram-close" id="instagramCloseIcon">&times;</span>
            <div class="popup-container">
                <div class="light-animation"></div>
                <div class="pulse-circle" style="top: -75px; left: -75px;"></div>
                <div class="pulse-circle" style="bottom: -75px; right: -75px;"></div>
                <div class="particles" id="particles"></div>
                
                <div class="header">
                    <h2><span class="instagram-logo">Instagram</span></h2>
                </div>
                
                <div class="profile-content">
                    <img src="https://i.postimg.cc/c1YKPWds/1757931606961.jpg" alt="Profile Image" class="profile-img">
                    
                    <div class="username">SNR__27 <img src="https://i.postimg.cc/02bVmN0y/badge.png" alt="Verified" class="developer-verified-badge"></div>
                    
                    <div class="stats">
                        <div class="stat">
                            <div class="stat-value" id="follower-count">
                                <span class="loading"></span>
                            </div>
                            <div class="stat-label">Followers</div>
                        </div>
                    </div>
                    
                    <button class="follow-btn" onclick="followUser()">
                        <i class="fas fa-user-plus"></i> Follow
                    </button>
                    <button class="close-btn" onclick="closeInstagramPopup()">
                        <i class="fas fa-times"></i> Close
                    </button>
                    
                    <div class="developer-text">Follow Developer</div>
                </div>
            </div>
        </div>
    </div>
    <!-- End Instagram Popup Modal -->

    <!-- Google Translate Element (hidden, controlled via select) -->
    <div id="google_translate_element"></div>

    <div class="admin-panel" id="adminPanel">
        <div class="container">
            <div class="admin-header">
                <h2><i class="fas fa-cog"></i> Admin Dashboard</h2>
                <button class="btn btn-outline" id="adminLogout">Logout</button>
            </div>
            <div class="admin-nav">
                <a href="#" class="active" data-section="dashboard"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
                <a href="#" data-section="banners"><i class="fas fa-image"></i> Banners</a>
                <a href="#" data-section="users"><i class="fas fa-users"></i> Users</a>
                <a href="#" data-section="content"><i class="fas fa-video"></i> Content</a>
                <a href="#" data-section="gallery"><i class="fas fa-camera-retro"></i> Gallery</a>
                <a href="#" data-section="payments"><i class="fas fa-money-check-alt"></i> Payments</a>
                <a href="#" data-section="notifications"><i class="fas fa-bell"></i> Notifications</a>
                <a href="#" data-section="chats"><i class="fas fa-comments"></i> Support Chats</a> <!-- NEW Chat section -->
                <a href="#" data-section="teachers"><i class="fas fa-chalkboard-teacher"></i> Teachers</a>
                <a href="#" data-section="plans"><i class="fas fa-crown"></i> Plans</a>
                <a href="#" data-section="settings"><i class="fas fa-cogs"></i> Settings</a>
            </div>
            <div class="admin-content">
                <div class="admin-section active" id="dashboardSection">
                    <h3>Dashboard Overview</h3>
                    <div class="stats-container">
                        <div class="stat-card">
                            <div class="stat-number" id="totalStudents">0</div>
                            <div class="stat-label">Total Students</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="premiumUsers">0</div>
                            <div class="stat-label">Premium Users</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="totalTeachers">0</div>
                            <div class="stat-label">Teachers</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="pendingPayments">0</div>
                            <div class="stat-label">Pending Payments</div>
                        </div>
                    </div>
                    
                    <h3>Recent Activity</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>User</th>
                                <th>Activity</th>
                                <th>Time</th>
                            </tr>
                        </thead>
                        <tbody id="recentActivityBody"></tbody>
                    </table>
                </div>

                <div class="admin-section" id="bannersSection">
                    <h3>Banner Management</h3>
                    <button class="btn btn-primary" id="addBannerBtn">Add New Banner</button>
                    <div class="add-form" id="bannerFormContainer" style="display: none;">
                        <form id="bannerForm">
                            <div class="form-group">
                                <label for="bannerTitle">Title</label>
                                <input type="text" id="bannerTitle" required>
                            </div>
                            <div class="form-group">
                                <label for="bannerDescription">Description</label>
                                <textarea id="bannerDescription"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="bannerImageUrl">Image URL</label>
                                <input type="text" id="bannerImageUrl" placeholder="https://example.com/image.jpg" required>
                            </div>
                            <div class="form-group">
                                <label for="bannerButtonText">Button Text</label>
                                <input type="text" id="bannerButtonText" placeholder="e.g., Subscribe Now">
                            </div>
                            <div class="form-group">
                                <label for="bannerButtonUrl">Button URL</label>
                                <input type="url" id="bannerButtonUrl" placeholder="https://example.com/link">
                            </div>
                            <div class="form-group">
                                <label for="bannerStartDate">Start Date</label>
                                <input type="date" id="bannerStartDate">
                            </div>
                            <div class="form-group">
                                <label for="bannerEndDate">End Date</label>
                                <input type="date" id="bannerEndDate">
                            </div>
                            <div class="action-buttons">
                                <button type="submit" class="btn btn-primary">Save Banner</button>
                                <button type="button" class="btn btn-outline" id="cancelBanner">Cancel</button>
                            </div>
                        </form>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Image</th>
                                <th>Button</th>
                                <th>Dates</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="bannersTableBody"></tbody>
                    </table>
                </div>
                
                <div class="admin-section" id="usersSection">
                    <h3>User Management</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody"></tbody>
                    </table>
                </div>
                
                <div class="admin-section" id="contentSection">
                    <h3>Content Management</h3>
                    <button class="btn btn-primary" id="addContentBtn">Add New Content</button>
                    <div class="add-form" id="contentFormContainer" style="display: none;">
                        <form id="contentForm">
                            <div class="form-group">
                                <label for="contentTitle">Title</label>
                                <input type="text" id="contentTitle" required>
                            </div>
                            <!-- NEW: Category selection for Admin -->
                            <div class="form-group">
                                <label for="contentCategory">Category</label>
                                <select id="contentCategory" required>
                                    <option value="+2">+2</option>
                                    <option value="+3">+3</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="contentType">Type</label>
                                <select id="contentType" required>
                                    <option value="video">Video</option>
                                    <option value="note">Note</option>
                                    <option value="quiz">Quiz</option>
                                </select>
                            </div>
                            <div class="form-group" id="contentUrlGroup">
                                <label for="contentUrl">URL/Link (for Video/Note/Optional for Quiz)</label>
                                <input type="text" id="contentUrl">
                            </div>
                            <div class="form-group">
                                <label for="contentDescription">Description</label>
                                <textarea id="contentDescription"></textarea>
                            </div>

                            <!-- Quiz Specific Fields (Dynamically shown/hidden) -->
                            <div id="quizFields" style="display:none;">
                                <div class="form-group">
                                    <label for="quizQuestion">Question</label>
                                    <input type="text" id="quizQuestion" placeholder="Enter quiz question">
                                </div>
                                <div class="form-group">
                                    <label for="quizOption1">Option 1</label>
                                    <input type="text" id="quizOption1" placeholder="Enter option 1">
                                </div>
                                <div class="form-group">
                                    <label for="quizOption2">Option 2</label>
                                    <input type="text" id="quizOption2" placeholder="Enter option 2">
                                </div>
                                <div class="form-group">
                                    <label for="quizOption3">Option 3</label>
                                    <input type="text" id="quizOption3" placeholder="Enter option 3">
                                </div>
                                <div class="form-group">
                                    <label for="quizOption4">Option 4</label>
                                    <input type="text" id="quizOption4" placeholder="Enter option 4">
                                </div>
                                <div class="form-group">
                                    <label for="quizCorrectAnswer">Correct Answer (e.g., "Option 2")</label>
                                    <input type="text" id="quizCorrectAnswer" placeholder="Enter the text of the correct option">
                                </div>
                            </div>
                            <!-- End Quiz Specific Fields -->

                            <div class="form-group">
                                <label for="contentAccess">Access Type</label>
                                <select id="contentAccess" required>
                                    <option value="free">Free</option>
                                    <option value="premium">Premium</option>
                                    <option value="buy">Buy</option>
                                </select>
                            </div>
                            <div class="form-group" id="contentPriceContainer" style="display: none;">
                                <label for="contentPrice">Price (â‚¹)</label>
                                <input type="number" id="contentPrice" placeholder="Enter price for premium/buy content">
                            </div>
                            <div class="action-buttons">
                                <button type="submit" class="btn btn-primary">Save Content</button>
                                <button type="button" class="btn btn-outline" id="cancelContent">Cancel</button>
                            </div>
                        </form>
                    </div>
                    <div class="content-grid" id="adminContentGrid"></div>
                </div>

                <!-- New Gallery Admin Section -->
                <div class="admin-section" id="gallerySection">
                    <h3>Gallery Management</h3>
                    <button class="btn btn-primary" id="addGalleryItemBtn">Add New Gallery Item</button>
                    <div class="add-form" id="galleryFormContainer" style="display: none;">
                        <form id="galleryForm">
                            <div class="form-group">
                                <label for="galleryItemTitle">Title</label>
                                <input type="text" id="galleryItemTitle" required>
                            </div>
                            <div class="form-group">
                                <label for="galleryItemDescription">Description</label>
                                <textarea id="galleryItemDescription"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="galleryItemType">Type</label>
                                <select id="galleryItemType" required>
                                    <option value="photo">Photo</option>
                                    <option value="video">Video</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="galleryItemUrl">URL (Image or Video Link)</label>
                                <input type="url" id="galleryItemUrl" required>
                            </div>
                            <div class="action-buttons">
                                <button type="submit" class="btn btn-primary">Save Item</button>
                                <button type="button" class="btn btn-outline" id="cancelGalleryItem">Cancel</button>
                            </div>
                        </form>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Type</th>
                                <th>URL</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="galleryTableBody"></tbody>
                    </table>
                </div>
                
                <div class="admin-section" id="paymentsSection">
                    <h3>Payment Verification</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>User</th>
                                <th>UTR Number</th>
                                <th>Amount</th>
                                <th>Status</th>
                                <th>Screenshot</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="paymentsTableBody"></tbody>
                    </table>
                </div>
                
                <div class="admin-section" id="notificationsSection">
                    <h3>Send Notification</h3>
                    <form id="notificationForm">
                        <div class="form-group">
                            <label for="notificationTitle">Title</label>
                            <input type="text" id="notificationTitle" placeholder="Enter notification title" required>
                        </div>
                        <div class="form-group">
                            <label for="notificationMessage">Message</label>
                            <textarea id="notificationMessage" rows="4" placeholder="Enter notification message" required></textarea>
                        </div>
                        <!-- NEW field for image URL -->
                        <div class="form-group">
                            <label for="notificationImageUrl">Image URL (Optional)</label>
                            <input type="url" id="notificationImageUrl" placeholder="https://example.com/image.png">
                        </div>
                        <button type="submit" class="btn btn-primary">Send Notification</button>
                    </form>
                    
                    <h3 style="margin-top: 2rem;">Recent Notifications</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Message</th>
                                <th>Image</th>
                                <th>Date</th>
                            </tr>
                        </thead>
                        <tbody id="notificationsTableBody"></tbody>
                    </table>
                    <button class="btn btn-danger" id="deleteAllNotificationsBtn" style="margin-top: 1rem;">Delete All Notifications</button>
                </div>
                
                <!-- NEW: Admin Chat Section -->
                <div class="admin-section" id="chatsSection">
                    <h3>Support Chats</h3>
                    <div class="admin-chat-layout">
                        <div class="admin-chat-list" id="adminChatList">
                            <!-- User chats will be listed here -->
                        </div>
                        <div class="admin-chat-window" id="adminChatWindow">
                            <div class="admin-chat-window-placeholder">Select a chat to view messages</div>
                            <!-- Messages and input form will appear here -->
                        </div>
                    </div>
                </div>

                <div class="admin-section" id="teachersSection">
                    <h3>Teacher Management</h3>
                    <button class="btn btn-primary" id="addTeacherBtn">Add New Teacher</button>
                    <div class="add-form" id="teacherFormContainer" style="display: none;">
                        <form id="teacherForm">
                            <div class="form-group">
                                <label for="teacherName">Name</label>
                                <input type="text" id="teacherName" required>
                            </div>
                            <div class="form-group">
                                <label for="teacherSubject">Subject</label>
                                <input type="text" id="teacherSubject" required>
                            </div>
                            <div class="form-group">
                                <label for="teacherExperience">Experience</label>
                                <input type="text" id="teacherExperience">
                            </div>
                            <div class="form-group">
                                <label for="teacherPhotoUrls">Photo URLs (comma separated)</label>
                                <input type="text" id="teacherPhotoUrls" placeholder="URL1, URL2, URL3">
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="teacherVerified"> Verified
                                </label>
                            </div>
                            <div class="action-buttons">
                                <button type="submit" class="btn btn-primary">Save Teacher</button>
                                <button type="button" class="btn btn-outline" id="cancelTeacher">Cancel</button>
                            </div>
                        </form>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Subject</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="teachersTableBody"></tbody>
                    </table>
                </div>

                <div class="admin-section" id="plansSection">
                    <h3>Premium Plan Management</h3>
                    <button class="btn btn-primary" id="addPlanBtn">Add New Plan</button>
                    <div class="add-form" id="planFormContainer" style="display: none;">
                        <form id="planForm">
                            <div class="form-group">
                                <label for="planName">Plan Name (e.g., 1 Month)</label>
                                <input type="text" id="planName" required>
                            </div>
                            <div class="form-group">
                                <label for="planPrice">Price (â‚¹)</label>
                                <input type="number" id="planPrice" required>
                            </div>
                            <div class="form-group">
                                <label for="planDescription">Description</label>
                                <textarea id="planDescription"></textarea>
                            </div>
                            <div class="action-buttons">
                                <button type="submit" class="btn btn-primary">Save Plan</button>
                                <button type="button" class="btn btn-outline" id="cancelPlan">Cancel</button>
                            </div>
                        </form>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Plan Name</th>
                                <th>Price</th>
                                <th>Description</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="plansTableBody"></tbody>
                    </table>
                </div>

                <!-- New Admin Settings Section -->
                <div class="admin-section" id="settingsSection">
                    <h3>General Settings</h3>
                    <form id="generalSettingsForm">
                        <div class="form-group">
                            <label for="adminVerifyBadgePrice">Verified Badge Price (â‚¹)</label>
                            <input type="number" id="adminVerifyBadgePrice" placeholder="Enter price for verification badge">
                        </div>
                        <div class="form-group">
                            <label for="displayTotalUsersCount">Total Users Display (e.g., 1M+, 250K+)</label>
                            <input type="text" id="displayTotalUsersCount" placeholder="Enter text for total users display">
                        </div>
                        <div class="form-group">
                            <label for="displayUserNames">Display User Names (comma separated for rotation)</label>
                            <textarea id="displayUserNames" rows="3" placeholder="John Doe, Jane Smith, etc."></textarea>
                        </div>

                        <h4 style="margin-top: 2rem; margin-bottom: 1rem; color: var(--primary);">Footer Settings</h4>
                        <div class="form-group">
                            <label for="settingsAboutUsText">About Us Text (Footer)</label>
                            <textarea id="settingsAboutUsText" rows="4"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="settingsSugamEmail">Sugam Academy Email (Footer)</label>
                            <input type="email" id="settingsSugamEmail">
                        </div>
                        <div class="form-group">
                            <label for="settingsDeveloperEmail">Developer Email (Footer)</label>
                            <input type="email" id="settingsDeveloperEmail">
                        </div>
                        <div class="form-group">
                            <label for="settingsYoutubeLink">YouTube Link</label>
                            <input type="url" id="settingsYoutubeLink" placeholder="https://youtube.com/...">
                        </div>
                        <div class="form-group">
                            <label for="settingsInstagramLink">Instagram Link</label>
                            <input type="url" id="settingsInstagramLink" placeholder="https://instagram.com/...">
                        </div>
                        <div class="form-group">
                            <label for="settingsFacebookLink">Facebook Link</label>
                            <input type="url" id="settingsFacebookLink" placeholder="https://facebook.com/...">
                        </div>
                        <div class="form-group">
                            <label for="settingsTwitterLink">Twitter Link</label>
                            <input type="url" id="settingsTwitterLink" placeholder="https://twitter.com/...">
                        </div>
                        
                        <button type="submit" class="btn btn-primary">Save Settings</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- User Notification Bar -->
    <div class="user-notification-bar" id="userNotificationBar">
        <p><span id="userNotificationCount">0</span> users are learning with <span id="userNotificationName">Loading...</span></p>
    </div>

    <!-- NEW: Floating Chat Button and Widget for users -->
    <div class="chat-fab" id="chatFab">
        <i class="fas fa-comments"></i>
    </div>
    <div class="chat-widget" id="chatWidget">
        <div class="chat-widget-header">
            <span>Chat with Admin</span>
            <span class="close-chat" id="closeChatWidget">&times;</span>
        </div>
        <div class="chat-messages" id="chatMessagesContainer">
            <!-- Messages will be loaded here -->
        </div>
        <form class="chat-input-form" id="chatInputForm">
            <input type="text" id="chatMessageInput" placeholder="Type your message..." autocomplete="off" required>
            <button type="submit"><i class="fas fa-paper-plane"></i></button>
        </form>
    </div>

    <!-- NEW: Container for Notification Toasts -->
    <div class="notification-toast-container" id="notificationToastContainer"></div>


    <script>
        // Firebase configuration and initialization
        const firebaseConfig = {
            apiKey: "AIzaSyAihXZD_jNeEgLAAIAoVNkiRekbVJpKkDI",
            authDomain: "sugam-acadamy.firebaseapp.com",
            databaseURL: "https://sugam-acadamy-default-rtdb.firebaseio.com",
            projectId: "sugam-acadamy",
            storageBucket: "sugam-acadamy.firebasestorage.app",
            messagingSenderId: "543228439687",
            appId: "1:543228439687:web:4e4140d19a503e6d081c22",
            measurementId: "G-HD1SGYMM89"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();
        const storage = firebase.storage();

        // UPI Configuration
        const UPI_VPA = 'mrperfect11457@oksbi';
        const UPI_NAME = 'Sugam Academy';
        const UPI_CURRENCY = 'INR';

        // DOM Elements
        const loginRegisterBtn = document.getElementById('loginRegisterBtn'); 
        const userAuthenticatedControls = document.querySelector('.user-authenticated-controls'); // New container
        const notificationBell = document.getElementById('notificationBell');
        const notificationCount = document.getElementById('notificationCount');
        
        // Combined Auth Modal Elements
        const authModal = document.getElementById('authModal'); 
        const showLoginTab = document.getElementById('showLoginTab');
        const showRegisterTab = document.getElementById('showRegisterTab');
        const loginFormContainer = document.getElementById('loginFormContainer');
        const registerFormContainer = document.getElementById('registerFormContainer');
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const forgotPassword = document.getElementById('forgotPassword');
        
        const premiumModal = document.getElementById('premiumModal');
        const videoBuyModal = document.getElementById('videoBuyModal'); // Reused for video & badge
        const quizModal = document.getElementById('quizModal'); // New quiz modal
        const contentDisplayModal = document.getElementById('contentDisplayModal'); // New content display modal
        const contentDisplayModalTitle = document.getElementById('contentDisplayModalTitle');
        const contentIframeWrapper = contentDisplayModal.querySelector('.content-iframe-wrapper');

        // NEW: Modals for Favorites and Purchases
        const myFavoritesModal = document.getElementById('myFavoritesModal');
        const favoritesContentGrid = document.getElementById('favoritesContentGrid');
        const myPurchasesModal = document.getElementById('myPurchasesModal');
        const purchasesTableBody = document.getElementById('purchasesTableBody');

        const closeModalButtons = document.querySelectorAll('.close-modal'); // Generic close buttons

        const adminPanel = document.getElementById('adminPanel');
        const adminLogout = document.getElementById('adminLogout');
        const adminNavLinks = document.querySelectorAll('.admin-nav a');
        const adminSections = document.querySelectorAll('.admin-section');
        const teachersContainer = document.getElementById('teachersContainer');
        const totalStudents = document.getElementById('totalStudents');
        const premiumUsers = document.getElementById('premiumUsers');
        const totalTeachers = document.getElementById('totalTeachers');
        const pendingPayments = document.getElementById('pendingPayments');
        const usersTableBody = document.getElementById('usersTableBody');
        const paymentsTableBody = document.getElementById('paymentsTableBody');
        const notificationsTableBody = document.getElementById('notificationsTableBody');
        const deleteAllNotificationsBtn = document.getElementById('deleteAllNotificationsBtn'); // New button
        const teachersTableBody = document.getElementById('teachersTableBody');
        const addTeacherBtn = document.getElementById('addTeacherBtn');
        const teacherFormContainer = document.getElementById('teacherFormContainer');
        const teacherForm = document.getElementById('teacherForm');
        const cancelTeacher = document.getElementById('cancelTeacher');
        const addContentBtn = document.getElementById('addContentBtn');
        const contentFormContainer = document.getElementById('contentFormContainer');
        const contentForm = document.getElementById('contentForm');
        const cancelContent = document.getElementById('cancelContent');
        const adminContentGrid = document.getElementById('adminContentGrid');
        const notificationForm = document.getElementById('notificationForm');
        const videoContentGrid = document.getElementById('videoContentGrid');
        const notesContentGrid = document.getElementById('notesContentGrid');
        const quizContentGrid = document.getElementById('quizContentGrid');
        const galleryContentGrid = document.getElementById('galleryContentGrid'); // New gallery grid
        
        // NEW: Category Selector Elements
        const categorySelector = document.getElementById('categorySelector');

        const contentType = document.getElementById('contentType');
        const contentUrlGroup = document.getElementById('contentUrlGroup');
        const contentUrlInput = document.getElementById('contentUrl');
        const quizFields = document.getElementById('quizFields');
        const contentAccess = document.getElementById('contentAccess');
        const contentPriceContainer = document.getElementById('contentPriceContainer');
        const tabLinks = document.querySelectorAll('.tab-link');
        const contentTabs = document.querySelector('.content-tabs'); // NEW: content tabs container
        const contentSections = document.querySelectorAll('.content-section');
        const premiumPaymentSection = document.getElementById('premiumPaymentSection');
        const UTRNumberInput = document.getElementById('UTRNumber');
        const displayPremiumAmount = document.getElementById('displayPremiumAmount');
        const addPlanBtn = document.getElementById('addPlanBtn');
        const planFormContainer = document.getElementById('planFormContainer');
        const planForm = document.getElementById('planForm');
        const cancelPlan = document.getElementById('cancelPlan');
        const plansTableBody = document.getElementById('plansTableBody');
        const buyModalTitle = document.getElementById('buyModalTitle');
        const itemPriceToBuy = document.getElementById('itemPriceToBuy');
        const itemUTRNumber = document.getElementById('itemUTRNumber');
        const itemPaymentSection = document.getElementById('itemPaymentSection');

        const bannerSlider = document.getElementById('bannerSlider');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const currentBannerButtonWrapper = document.getElementById('currentBannerButtonWrapper');
        const heroDynamicBg = document.getElementById('heroDynamicBg'); // New dynamic hero background element
        const addBannerBtn = document.getElementById('addBannerBtn');
        const bannerFormContainer = document.getElementById('bannerFormContainer');
        const bannerForm = document.getElementById('bannerForm');
        const cancelBanner = document.getElementById('cancelBanner');
        const bannersTableBody = document.getElementById('bannersTableBody');

        // New Profile Dropdown Elements
        const profileMenuToggleBtn = document.getElementById('profileMenuToggleBtn');
        const profileDropdownMenu = document.getElementById('profileDropdownMenu');
        const dropdownUserName = document.getElementById('dropdownUserName');
        const dropdownPremiumStatus = document.getElementById('dropdownPremiumStatus');
        const dropdownNotificationCount = document.getElementById('dropdownNotificationCount');
        const dropdownGoPremiumBtn = document.getElementById('dropdownGoPremiumBtn');
        const dropdownLogoutBtn = document.getElementById('dropdownLogoutBtn');
        const myPurchasesLink = document.getElementById('myPurchasesLink');
        const myFavoritesLink = document.getElementById('myFavoritesLink');
        const getVerifiedBadgeLink = document.getElementById('getVerifiedBadgeLink');
        const viewNotificationsLink = document.getElementById('viewNotificationsLink');
        const dropdownVerifiedBadge = document.getElementById('dropdownVerifiedBadge');

        // Dynamic User Display Elements (Moved to floating notification)
        const userNotificationBar = document.getElementById('userNotificationBar');
        const userNotificationCount = document.getElementById('userNotificationCount');
        const userNotificationName = document.getElementById('userNotificationName');

        // Admin Settings Elements
        const generalSettingsForm = document.getElementById('generalSettingsForm');
        const adminVerifyBadgePrice = document.getElementById('adminVerifyBadgePrice');
        const displayTotalUsersCountInput = document.getElementById('displayTotalUsersCount');
        const displayUserNamesInput = document.getElementById('displayUserNames');
        const settingsAboutUsText = document.getElementById('settingsAboutUsText');
        const settingsSugamEmail = document.getElementById('settingsSugamEmail');
        const settingsDeveloperEmail = document.getElementById('settingsDeveloperEmail');
        const settingsYoutubeLink = document.getElementById('settingsYoutubeLink');
        const settingsInstagramLink = document.getElementById('settingsInstagramLink');
        const settingsFacebookLink = document.getElementById('settingsFacebookLink');
        const settingsTwitterLink = document.getElementById('settingsTwitterLink');

        // Footer Elements
        const footerAboutUsText = document.getElementById('footerAboutUsText');
        const footerSugamEmail = document.getElementById('footerSugamEmail');
        const footerDeveloperEmail = document.getElementById('footerDeveloperEmail');
        const footerYoutubeLink = document.getElementById('footerYoutubeLink');
        const footerInstagramLink = document.getElementById('footerInstagramLink');
        const footerFacebookLink = document.getElementById('footerFacebookLink');
        const footerTwitterLink = document.getElementById('footerTwitterLink');

        // Quiz Modal Elements
        const quizModalTitle = document.getElementById('quizModalTitle');
        const quizQuestionText = document.getElementById('quizQuestionText');
        const quizOptions = document.getElementById('quizOptions');
        const submitQuizAnswerBtn = document.getElementById('submitQuizAnswerBtn');
        const quizFeedback = document.getElementById('quizFeedback');
        const closeQuizFeedbackBtn = document.getElementById('closeQuizFeedbackBtn');

        // Admin Gallery Elements
        const addGalleryItemBtn = document.getElementById('addGalleryItemBtn');
        const galleryFormContainer = document.getElementById('galleryFormContainer');
        const galleryForm = document.getElementById('galleryForm');
        const cancelGalleryItem = document.getElementById('cancelGalleryItem');
        const galleryTableBody = document.getElementById('galleryTableBody');

        // NEW: Top Scorer Element
        const topScorerBanner = document.getElementById('topScorerBanner');


        // Instagram Popup Elements 
        const instagramPopupModal = document.getElementById('instagramPopupModal');
        const instagramCloseIcon = document.getElementById('instagramCloseIcon'); 
        const instagramPopupContainer = instagramPopupModal.querySelector('.popup-container'); 
        const instagramFollowBtn = instagramPopupModal.querySelector('.follow-btn'); 
        const instagramCloseBtnInner = instagramPopupModal.querySelector('.close-btn'); 
        const instagramFollowerCount = document.getElementById('follower-count');
        
        // NEW: Chat System Elements
        const chatFab = document.getElementById('chatFab');
        const chatWidget = document.getElementById('chatWidget');
        const closeChatWidget = document.getElementById('closeChatWidget');
        const chatMessagesContainer = document.getElementById('chatMessagesContainer');
        const chatInputForm = document.getElementById('chatInputForm');
        const chatMessageInput = document.getElementById('chatMessageInput');
        const adminChatList = document.getElementById('adminChatList');
        const adminChatWindow = document.getElementById('adminChatWindow');
        const notificationToastContainer = document.getElementById('notificationToastContainer');

        // Global variables
        let currentVideoToBuy = {}; 
        let currentPaymentType = ''; 
        let currentQuizData = null; 
        let currentQuizId = null; 
        let currentAdminChatUserId = null; 
        let currentUserView = '+2'; // NEW: Default content view category

        // Banner Slider State
        let currentBannerIndex = 0;
        let bannerInterval;
        let popupAutoCloseTimer; // For Instagram popup
        let followerUpdateInterval; // For clearing the follower update interval
        
        // Dynamic User Display State
        let displayedUserNames = [];
        let userNameRotationInterval;
        let userNotificationBarInterval;

        // Verify badge image URL
        const VERIFIED_BADGE_IMG_URL = 'https://i.postimg.cc/02bVmN0y/badge.png';

        // --- Core Event Listeners and UI Update ---

        // Toggle Profile Dropdown
        profileMenuToggleBtn.addEventListener('click', (e) => {
            e.stopPropagation(); // Prevent document click from immediately closing
            profileDropdownMenu.style.display = profileDropdownMenu.style.display === 'block' ? 'none' : 'block';
        });

        // Close dropdown if clicked outside
        document.addEventListener('click', (e) => {
            if (profileDropdownMenu.style.display === 'block' && !profileDropdownMenu.contains(e.target) && !profileMenuToggleBtn.contains(e.target)) {
                profileDropdownMenu.style.display = 'none';
            }
        });

        // Login/Register button click -> open auth modal
        loginRegisterBtn.addEventListener('click', () => {
            authModal.style.display = 'flex';
            showLoginTab.click(); // Default to login tab
        });

        // Premium button in dropdown
        dropdownGoPremiumBtn.addEventListener('click', () => {
            profileDropdownMenu.style.display = 'none'; // Close dropdown
            openPremiumModal(); // Open the premium payment modal
        });

        // Logout from dropdown
        dropdownLogoutBtn.addEventListener('click', () => auth.signOut());

        // NEW: My Purchases Link
        myPurchasesLink.addEventListener('click', (e) => {
            e.preventDefault();
            profileDropdownMenu.style.display = 'none'; // Close dropdown
            openMyPurchasesModal();
        });

        // NEW: My Favorites Link
        myFavoritesLink.addEventListener('click', (e) => {
            e.preventDefault();
            profileDropdownMenu.style.display = 'none'; // Close dropdown
            openMyFavoritesModal();
        });
        
        // Get Verified Badge Link
        getVerifiedBadgeLink.addEventListener('click', async (e) => {
            e.preventDefault();
            profileDropdownMenu.style.display = 'none'; // Close dropdown
            const settingsSnap = await db.ref('settings').once('value');
            const settings = settingsSnap.val();
            const badgePrice = settings?.adminVerifyBadgePrice || 100; // Default price if not set
            openBuyModal('verifyBadge', 'Get Verified Badge', badgePrice);
        });
        
        // View Notifications Link
        viewNotificationsLink.addEventListener('click', (e) => {
            e.preventDefault();
            alert('Notifications section coming soon!'); // Or navigate to a notification page/modal
            profileDropdownMenu.style.display = 'none'; // Close dropdown
        });

        // --- Generic Modal Closers ---
        closeModalButtons.forEach(button => {
            if (button.id !== 'instagramCloseIcon') { // Exclude the specific Instagram close icon
                button.addEventListener('click', () => {
                    const modal = button.closest('.modal');
                    if (modal) {
                        modal.style.display = 'none';
                    }
                });
            }
        });

        // Combined Auth Modal Tab Switching
        showLoginTab.addEventListener('click', () => {
            showLoginTab.classList.add('active');
            showRegisterTab.classList.remove('active');
            loginFormContainer.style.display = 'block';
            registerFormContainer.style.display = 'none';
        });

        showRegisterTab.addEventListener('click', () => {
            showRegisterTab.classList.add('active');
            showLoginTab.classList.remove('active');
            registerFormContainer.style.display = 'block';
            loginFormContainer.style.display = 'none';
        });

        // --- Other UI and Data Loading Functions ---
        
        // NEW: Category (+2/+3) Selector Logic
        categorySelector.addEventListener('click', (e) => {
            if (e.target.tagName === 'BUTTON') {
                const selectedCategory = e.target.dataset.category;
                if (selectedCategory === currentUserView) return; // Do nothing if already selected

                // Update UI
                categorySelector.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));
                e.target.classList.add('active');
                
                // Update state
                currentUserView = selectedCategory;

                // Reload content with the new category
                const user = auth.currentUser;
                if(user) {
                    db.ref('users/' + user.uid).once('value').then(snap => {
                        const userData = snap.val() || {};
                        loadContent(true, userData.premium, userData.purchasedVideos, userData.favorites, currentUserView);
                        // Save user's preference
                        db.ref('users/' + user.uid).update({ currentView: currentUserView });
                    });
                } else {
                    loadContent(false, false, {}, {}, currentUserView);
                }
            }
        });

        // Tab Navigation for content sections
        tabLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const tab = link.getAttribute('data-tab');
                
                // Handle Gallery separately
                if (tab === 'gallery') {
                    // Hide main content section and show gallery
                    document.getElementById('content').style.display = 'none';
                    document.getElementById('gallery').style.display = 'block';
                    
                    // Update tab link states
                    document.querySelectorAll('.tab-link').forEach(l => l.classList.remove('active'));
                    link.classList.add('active');
                } else {
                    // Show main content section and hide gallery
                    document.getElementById('content').style.display = 'block';
                    document.getElementById('gallery').style.display = 'none';

                    // Update sub-tabs within the content section
                    contentTabs.querySelectorAll('.tab-link').forEach(l => l.classList.remove('active'));
                    contentTabs.querySelector(`.tab-link[data-tab="${tab}"]`).classList.add('active');

                    // Show the correct content grid
                    document.querySelectorAll('#content .content-section').forEach(s => s.style.display = 'none');
                    document.getElementById(tab).style.display = 'block';
                }
                
                const targetSection = document.getElementById(tab === 'gallery' ? 'gallery' : 'content');
                targetSection.scrollIntoView({ behavior: 'smooth' });
            });
        });

        // Admin Navigation
        adminNavLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const section = link.getAttribute('data-section');
                
                adminNavLinks.forEach(l => l.classList.remove('active'));
                link.classList.add('active');
                
                adminSections.forEach(s => s.classList.remove('active'));
                document.getElementById(`${section}Section`).classList.add('active');

                // Load data for specific sections when they become active
                if (section === 'settings') loadAdminSettings();
                else if (section === 'gallery') loadAdminGallery();
                else if (section === 'chats') loadAdminChatList(); // Load chat list
            });
        });

        // Show/Hide Price Field Based on Access Type
        contentAccess.addEventListener('change', () => {
            const isPaid = (contentAccess.value === 'premium' || contentAccess.value === 'buy');
            contentPriceContainer.style.display = isPaid ? 'block' : 'none';
            document.getElementById('contentPrice').required = isPaid; // Set required based on visibility
        });

        // Show/Hide Quiz Specific Fields based on Content Type
        contentType.addEventListener('change', () => {
            const isQuiz = contentType.value === 'quiz';
            quizFields.style.display = isQuiz ? 'block' : 'none';
            contentUrlInput.required = !isQuiz; 

            document.getElementById('quizQuestion').required = false;
            document.getElementById('quizOption1').required = false;
            document.getElementById('quizOption2').required = false;
            document.getElementById('quizOption3').required = false;
            document.getElementById('quizOption4').required = false;
            document.getElementById('quizCorrectAnswer').required = false;
        });

        // Auth State Listener
        auth.onAuthStateChanged(user => {
            if (user) {
                // User is logged in
                db.ref('users/' + user.uid).on('value', snap => { // Use .on() for real-time user data updates
                    const userData = snap.val();
                    if (user.email === 'sugamacadamy@gmail.com') { // Admin email
                        showAdminPanel();
                    } else {
                        updateUI(userData);
                    }
                }, error => {
                     console.error("Error fetching user data on auth state change:", error);
                    auth.signOut();
                });
            } else {
                // User is logged out
                updateUI(null);
            }
        });

        async function updateUI(userData) {
            document.body.style.display = 'block';
            adminPanel.style.display = 'none';
            
            document.querySelector('header').style.display = 'block';
            document.querySelector('.hero').style.display = 'flex'; 
            document.querySelector('footer').style.display = 'block';
            document.querySelectorAll('section').forEach(s => {
                if(s.id !== 'adminPanel') s.style.display = 'block'; 
            });
            // Hide content section initially, it will be shown by the logic below
            document.getElementById('content').style.display = 'none';

            
            if (userData && userData.name) {
                // User is logged in
                loginRegisterBtn.style.display = 'none';
                userAuthenticatedControls.style.display = 'flex';
                profileDropdownMenu.style.display = 'none';

                dropdownUserName.textContent = userData.name;
                dropdownPremiumStatus.textContent = userData.premium ? 'Premium User' : 'Free User';
                dropdownGoPremiumBtn.style.display = userData.premium ? 'none' : 'block';
                dropdownVerifiedBadge.style.display = userData.isVerified ? 'inline-block' : 'none';

                // NEW: Set user's preferred view
                currentUserView = userData.currentView || '+2'; // Default to +2 if not set
                categorySelector.querySelectorAll('button').forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.category === currentUserView);
                });

                loadNotificationsCount();
                loadContent(true, userData.premium, userData.purchasedVideos || {}, userData.favorites || {}, currentUserView);
                loadGallery();
                
                chatFab.style.display = 'flex';
                initializeUserChat();

            } else {
                // User is not logged in
                loginRegisterBtn.style.display = 'flex';
                userAuthenticatedControls.style.display = 'none';
                profileDropdownMenu.style.display = 'none';
                
                // NEW: For logged-out users, default to +2 and load content
                currentUserView = '+2';
                categorySelector.querySelectorAll('button').forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.category === currentUserView);
                });
                loadContent(false, false, {}, {}, currentUserView);
                loadGallery();
                
                chatFab.style.display = 'none';
                chatWidget.style.display = 'none';
            }

            // Always load public data
            loadTeachers();
            loadBanners();
            loadTopScorer();
            loadDynamicUserDisplay();
            await renderFooter();
        }

        // Login Form Submission
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            auth.signInWithEmailAndPassword(email, password)
                .then(() => {
                    authModal.style.display = 'none';
                    loginForm.reset();
                })
                .catch((error) => {
                    alert(error.message);
                });
        });

        // Register Form Submission
        registerForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;
            
            if (password !== confirmPassword) {
                alert("Passwords don't match!");
                return;
            }
            
            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    
                    db.ref('users/' + user.uid).set({
                        name: name,
                        email: email,
                        premium: false,
                        isVerified: false, 
                        joined: Date.now(),
                        purchasedVideos: {},
                        favorites: {},
                        currentView: '+2' // NEW: Set default view on registration
                    });
                    
                    authModal.style.display = 'none';
                    registerForm.reset();
                })
                .catch((error) => {
                    alert(error.message);
                });
        });
        
        // Universal payment submission function
        function submitPaymentDetails(paymentType) {
            const user = auth.currentUser;
            if (!user) {
                alert('Please login to submit your payment details.');
                return;
            }

            let amount, utrNumber, contentId = null, title;
            let targetRef = 'payments'; 
            
            if (paymentType === 'premium') {
                amount = displayPremiumAmount.textContent;
                utrNumber = UTRNumberInput.value;
                title = 'Premium Subscription';
            } else if (paymentType === 'video') {
                amount = itemPriceToBuy.textContent;
                utrNumber = itemUTRNumber.value;
                contentId = currentVideoToBuy.id; 
                title = currentVideoToBuy.title;
            } else if (paymentType === 'verifyBadge') {
                amount = itemPriceToBuy.textContent;
                utrNumber = itemUTRNumber.value;
                title = 'Verified Badge';
            }

            if (!utrNumber || !/^\d{12}$/.test(utrNumber)) {
                alert('Please enter a valid 12-digit UTR number.');
                return;
            }
            
            const paymentRef = db.ref(targetRef).push();
            
            paymentRef.set({
                utr: utrNumber,
                amount: parseFloat(amount),
                status: 'pending',
                type: paymentType, 
                contentId: contentId, 
                title: title, 
                date: Date.now(),
                userId: user.uid
            }).then(() => {
                alert('Payment details submitted! Your request will be processed after verification.');
                premiumModal.style.display = 'none';
                videoBuyModal.style.display = 'none';
                UTRNumberInput.value = '';
                itemUTRNumber.value = '';
            }).catch(error => {
                alert('Error submitting payment: ' + error.message);
            });
        }
        
        // Logout
        adminLogout.addEventListener('click', () => auth.signOut());

        // Panel Management Functions
        async function showAdminPanel() {
            adminPanel.style.display = 'block';
            
            document.querySelector('header').style.display = 'none';
            document.querySelector('.hero').style.display = 'none'; 
            document.querySelector('footer').style.display = 'none';
            document.querySelectorAll('section').forEach(s => {
                if(s.id !== 'adminPanel') s.style.display = 'none';
            });
            closeInstagramPopup();
            
            loadDashboardStats();
            loadUsers();
            loadPayments();
            loadAdminNotifications();
            loadAdminTeachers();
            loadAdminContent();
            loadAdminGallery();
            loadAdminPlans();
            loadAdminBanners();
            loadAdminChatList();
            await loadAdminSettings();
        }

        // Forgot Password
        forgotPassword.addEventListener('click', (e) => {
            e.preventDefault();
            const email = prompt('Please enter your email address:');
            if (email) {
                auth.sendPasswordResetEmail(email)
                    .then(() => {
                        alert('Password reset email sent!');
                    })
                    .catch((error) => {
                        alert(error.message);
                    });
            }
        });

        // Load Banners for Public
        function loadBanners() {
            db.ref('banners').on('value', snapshot => {
                bannerSlider.innerHTML = '';
                currentBannerButtonWrapper.innerHTML = ''; 
                const banners = [];
                snapshot.forEach(child => {
                    const banner = child.val();
                    const startDate = banner.startDate ? new Date(banner.startDate) : null;
                    const endDate = banner.endDate ? new Date(banner.endDate) : null;
                    const today = new Date();
                    
                    if ((!startDate || today >= startDate) && (!endDate || today <= endDate)) {
                        banners.push(banner);
                    }
                });

                const heroSection = document.querySelector('.hero');
                const bannerContainer = heroSection.querySelector('.banner-slider-container');

                if (banners.length > 0) {
                    heroSection.style.display = 'flex'; 
                    bannerContainer.style.display = 'block';
                    
                    banners.forEach(banner => {
                        const slide = document.createElement('div');
                        slide.className = 'banner-slide';
                        slide.innerHTML = `<img src="${banner.imageUrl}" alt="${banner.title || 'Banner Image'}">`;
                        bannerSlider.appendChild(slide);
                    });
                    
                    initBannerSlider(banners);
                } else {
                    bannerContainer.style.display = 'none'; 
                    currentBannerButtonWrapper.style.display = 'none';
                    heroDynamicBg.style.backgroundImage = 'none';
                }
            });
        }
        
        // Banner Slider Logic
        function initBannerSlider(banners) {
            const slides = document.querySelectorAll('.banner-slide');
            if (slides.length === 0) {
                currentBannerButtonWrapper.style.display = 'none';
                heroDynamicBg.style.backgroundImage = 'none';
                return;
            }

            function updateSliderAndButton() {
                const offset = -currentBannerIndex * 100;
                bannerSlider.style.transform = `translateX(${offset}%)`;

                const currentBannerImageUrl = banners[currentBannerIndex]?.imageUrl;
                if (currentBannerImageUrl) {
                    document.documentElement.style.setProperty('--initial-bg-image', `url('${currentBannerImageUrl}')`);
                } else {
                    document.documentElement.style.setProperty('--initial-bg-image', 'none');
                }

                currentBannerButtonWrapper.innerHTML = ''; 
                if (banners[currentBannerIndex]?.buttonText && banners[currentBannerIndex]?.buttonUrl) {
                    const buttonHtml = `<a href="${banners[currentBannerIndex].buttonUrl}" target="_blank" class="btn btn-primary">${banners[currentBannerIndex].buttonText}</a>`;
                    currentBannerButtonWrapper.innerHTML = buttonHtml;
                    currentBannerButtonWrapper.style.display = 'block';
                } else {
                    currentBannerButtonWrapper.style.display = 'none';
                }
            }

            currentBannerIndex = 0; 
            updateSliderAndButton();

            const oldPrevBtn = document.getElementById('prevBtn');
            const oldNextBtn = document.getElementById('nextBtn');
            const newPrevBtn = oldPrevBtn.cloneNode(true);
            const newNextBtn = oldNextBtn.cloneNode(true);
            oldPrevBtn.replaceWith(newPrevBtn);
            oldNextBtn.replaceWith(newNextBtn);
            
            newNextBtn.addEventListener('click', () => { 
                currentBannerIndex = (currentBannerIndex + 1) % slides.length;
                updateSliderAndButton();
            });

            newPrevBtn.addEventListener('click', () => { 
                currentBannerIndex = (currentBannerIndex - 1 + slides.length) % slides.length;
                updateSliderAndButton();
            });

            clearInterval(bannerInterval);
            if (slides.length > 1) { 
                bannerInterval = setInterval(() => {
                    currentBannerIndex = (currentBannerIndex + 1) % slides.length;
                    updateSliderAndButton();
                }, 5000);
            }
        }

        // Load Teachers (Public and Real-time)
        function loadTeachers() {
            db.ref('teachers').on('value', snapshot => {
                const fragment = document.createDocumentFragment();
                teachersContainer.innerHTML = '';

                if (!snapshot.exists()) {
                    teachersContainer.innerHTML = '<p class="text-center">No teachers added yet.</p>';
                    return;
                }
                snapshot.forEach(child => {
                    const teacher = child.val();
                    const photos = teacher.photoUrls ? teacher.photoUrls.split(',').map(url => url.trim()).filter(url => url) : [];
                    
                    const teacherCard = document.createElement('div');
                    teacherCard.className = 'teacher-card';
                    
                    let imageSliderHtml = photos.length > 0
                        ? `<div class="teacher-image-slider" data-current="0">${photos.map((url, index) => `<div class="slide ${index === 0 ? 'active' : ''}"><img src="${url}" alt="${teacher.name || 'Teacher'} photo"></div>`).join('')}</div>`
                        : `<i class="fas fa-user" style="font-size: 5rem;"></i>`;
                    
                    teacherCard.innerHTML = `
                        <div class="teacher-img">${imageSliderHtml}</div>
                        <div class="teacher-info">
                            <h3>${teacher.name || 'N/A'} ${teacher.verified ? `<img src="${VERIFIED_BADGE_IMG_URL}" alt="Verified" class="verified-badge-img">` : ''}</h3>
                            <p>${teacher.subject || 'N/A'}</p>
                            <p>${teacher.experience || 'N/A'}</p>
                        </div>
                    `;
                    
                    let intervalId = null;
                    if (photos.length > 1) {
                        teacherCard.addEventListener('mouseenter', () => {
                            if (intervalId) return;
                            intervalId = setInterval(() => {
                                const slider = teacherCard.querySelector('.teacher-image-slider');
                                if (!slider) return;
                                const slides = slider.querySelectorAll('.slide');
                                if (slides.length <= 1) { clearInterval(intervalId); return; }
                                let current = parseInt(slider.dataset.current, 10);
                                slides[current].classList.remove('active');
                                current = (current + 1) % slides.length;
                                slides[current].classList.add('active');
                                slider.dataset.current = current;
                            }, 3000);
                        });
                        teacherCard.addEventListener('mouseleave', () => {
                            clearInterval(intervalId);
                            intervalId = null;
                        });
                    }
                    fragment.appendChild(teacherCard);
                });
                teachersContainer.appendChild(fragment);
            });
        }

        // Load Dashboard Stats
        function loadDashboardStats() {
            db.ref('users').once('value').then(snap => {
                totalStudents.textContent = snap.numChildren();
                let premiumCount = 0;
                snap.forEach(child => {
                    if (child.val().premium) premiumCount++;
                });
                premiumUsers.textContent = premiumCount;
            });
            db.ref('teachers').once('value').then(snap => totalTeachers.textContent = snap.numChildren());
            db.ref('payments').once('value').then(snap => {
                let pendingCount = 0;
                snap.forEach(child => {
                    if (child.val().status === 'pending') pendingCount++;
                });
                pendingPayments.textContent = pendingCount;
            });
        }

        // Load Users for Admin
        function loadUsers() {
            db.ref('users').on('value', snapshot => {
                usersTableBody.innerHTML = '';
                if (!snapshot.exists()) return;
                snapshot.forEach(child => {
                    const user = child.val();
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${user.name || 'N/A'} ${user.isVerified ? `<img src="${VERIFIED_BADGE_IMG_URL}" alt="Verified" class="verified-badge-img">` : ''}</td>
                        <td>${user.email || 'N/A'}</td>
                        <td>${user.premium ? '<span class="premium-badge">Premium</span>' : 'Free'}</td>
                        <td>
                            <button class="btn btn-primary" onclick="editUser('${child.key}')">Edit</button>
                            <button class="btn btn-outline" onclick="blockUser('${child.key}')">Block</button>
                        </td>
                    `;
                    usersTableBody.appendChild(row);
                });
            });
        }

        function editUser(uid) { alert('Edit user: ' + uid); }
        function blockUser(uid) { if (confirm('Block this user?')) db.ref('users/' + uid).update({blocked: true}).then(() => alert('User blocked')); }

        // Load Payments for Admin
        function loadPayments() {
            db.ref('payments').on('value', snapshot => {
                paymentsTableBody.innerHTML = '';
                if (!snapshot.exists()) return;
                
                const paymentPromises = [];
                snapshot.forEach(child => {
                    const payment = { ...child.val(), key: child.key };
                    paymentPromises.push(
                        db.ref('users/' + payment.userId).once('value').then(userSnap => ({ payment, user: userSnap.val() }))
                    );
                });

                Promise.all(paymentPromises).then(results => {
                    results.forEach(({ payment, user }) => {
                        const row = document.createElement('tr');
                        let actionButtons = '';
                        
                        if (payment.status === 'pending') {
                             if (payment.type === 'premium') actionButtons = `<button class="btn btn-primary" onclick="verifyPremiumPayment('${payment.key}', '${payment.userId}')">Verify</button>`;
                             else if (payment.type === 'video') actionButtons = `<button class="btn btn-primary" onclick="verifyVideoPayment('${payment.key}', '${payment.userId}', '${payment.contentId}')">Verify</button>`;
                             else if (payment.type === 'verifyBadge') actionButtons = `<button class="btn btn-primary" onclick="verifyBadgePayment('${payment.key}', '${payment.userId}')">Verify</button>`;
                            actionButtons += `<button class="btn btn-outline" onclick="rejectPayment('${payment.key}')">Reject</button>`;
                        } else if (payment.status === 'verified') actionButtons = `<span style="color: var(--success); font-weight: 600;">Successful</span>`;
                        else if (payment.status === 'rejected') actionButtons = `<span style="color: var(--danger); font-weight: 600;">Rejected</span>`;

                        row.innerHTML = `
                            <td>${user ? (user.name || 'N/A') : 'N/A'}</td>
                            <td>${payment.utr || 'N/A'}</td>
                            <td>â‚¹${payment.amount || '0'} (${payment.type || 'N/A'})</td>
                            <td><span class="status-badge status-${payment.status || 'pending'}">${(payment.status || 'pending').charAt(0).toUpperCase() + (payment.status || 'pending').slice(1)}</span></td>
                            <td>${payment.screenshotUrl ? `<a href="${payment.screenshotUrl}" target="_blank">View</a>` : 'None'}</td>
                            <td>${actionButtons}</td>
                        `;
                        paymentsTableBody.appendChild(row);
                    });
                });
            });
        }
        
        function verifyPremiumPayment(paymentId, userId) {
            db.ref('payments/' + paymentId).update({status: 'verified'}).then(() => {
                db.ref('users/' + userId).update({premium: true}).then(() => alert('Premium payment verified!'));
            });
        }
        
        function verifyVideoPayment(paymentId, userId, contentId) {
            db.ref('payments/' + paymentId).update({status: 'verified'}).then(() => {
                db.ref(`users/${userId}/purchasedVideos/${contentId}`).set(true).then(() => alert('Video payment verified!'));
            });
        }

        function verifyBadgePayment(paymentId, userId) {
            db.ref('payments/' + paymentId).update({status: 'verified'}).then(() => {
                db.ref('users/' + userId).update({isVerified: true}).then(() => alert('Verified badge payment verified!'));
            });
        }

        function rejectPayment(paymentId) { if (confirm('Reject this payment?')) db.ref('payments/' + paymentId).update({status: 'rejected'}).then(() => alert('Payment rejected.')); }

        // Load Notifications for Admin
        function loadAdminNotifications() {
            db.ref('notifications').on('value', snapshot => {
                notificationsTableBody.innerHTML = '';
                if (!snapshot.exists()) return;
                snapshot.forEach(child => {
                    const notif = child.val();
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${notif.title || 'N/A'}</td>
                        <td>${notif.message || 'N/A'}</td>
                        <td>${notif.imageUrl ? `<a href="${notif.imageUrl}" target="_blank">View Image</a>` : 'None'}</td>
                        <td>${new Date(notif.date).toLocaleDateString()}</td>
                    `;
                    notificationsTableBody.appendChild(row);
                });
            });
        }

        deleteAllNotificationsBtn.addEventListener('click', () => { if (confirm('Delete ALL notifications?')) db.ref('notifications').remove().then(() => alert('All notifications deleted!')); });

        notificationForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const title = document.getElementById('notificationTitle').value.trim();
            const message = document.getElementById('notificationMessage').value.trim();
            const imageUrl = document.getElementById('notificationImageUrl').value.trim();
            if (!title || !message) { alert('Title and message are required.'); return; }

            db.ref('notifications').push({ title, message, imageUrl: imageUrl || null, date: Date.now() })
                .then(() => { notificationForm.reset(); alert('Notification sent'); });
        });

        // Load Teachers for Admin
        function loadAdminTeachers() {
            db.ref('teachers').on('value', snapshot => {
                teachersTableBody.innerHTML = '';
                if (!snapshot.exists()) return;
                snapshot.forEach(child => {
                    const teacher = child.val();
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${teacher.name || 'N/A'} ${teacher.verified ? `<img src="${VERIFIED_BADGE_IMG_URL}" alt="Verified" class="verified-badge-img">` : ''}</td>
                        <td>${teacher.subject || 'N/A'}</td>
                        <td>Active</td>
                        <td>
                            <button class="btn btn-primary" onclick="editTeacher('${child.key}')">Edit</button>
                            <button class="btn btn-outline" onclick="deleteTeacher('${child.key}')">Delete</button>
                        </td>
                    `;
                    teachersTableBody.appendChild(row);
                });
            });
        }

        addTeacherBtn.addEventListener('click', () => { teacherForm.reset(); teacherForm.dataset.editId = ''; teacherFormContainer.style.display = 'block'; });
        cancelTeacher.addEventListener('click', () => teacherFormContainer.style.display = 'none');
        teacherForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('teacherName').value.trim();
            const subject = document.getElementById('teacherSubject').value.trim();
            const experience = document.getElementById('teacherExperience').value.trim();
            const photoUrls = document.getElementById('teacherPhotoUrls').value.trim();
            const verified = document.getElementById('teacherVerified').checked;
            if (!name || !subject) { alert('Name and Subject are required.'); return; }
            const data = { name, subject, experience: experience || null, photoUrls: photoUrls || null, verified };
            const editId = teacherForm.dataset.editId;
            if (editId) db.ref('teachers/' + editId).update(data).then(() => alert('Teacher updated!'));
            else db.ref('teachers').push(data).then(() => alert('Teacher added!'));
            teacherFormContainer.style.display = 'none';
        });

        function editTeacher(id) {
            db.ref('teachers/' + id).once('value').then(snap => {
                const t = snap.val();
                document.getElementById('teacherName').value = t.name || '';
                document.getElementById('teacherSubject').value = t.subject || '';
                document.getElementById('teacherExperience').value = t.experience || '';
                document.getElementById('teacherPhotoUrls').value = t.photoUrls || '';
                document.getElementById('teacherVerified').checked = t.verified || false;
                teacherForm.dataset.editId = id;
                teacherFormContainer.style.display = 'block';
            });
        }

        function deleteTeacher(id) { if (confirm('Delete teacher?')) db.ref('teachers/' + id).remove().then(() => alert('Teacher deleted!')); }

        // Load Content for Admin
        function loadAdminContent() {
            db.ref('content').on('value', snapshot => {
                adminContentGrid.innerHTML = '';
                if (!snapshot.exists()) return;
                snapshot.forEach(child => {
                    const content = child.val();
                    const card = document.createElement('div');
                    card.className = 'content-card';
                    card.innerHTML = `
                        <div class="content-thumb"><i class="fas fa-${content.type === 'video' ? 'video' : content.type === 'note' ? 'file-pdf' : 'brain'}"></i></div>
                        <div class="content-info">
                            <h3>${content.title || 'N/A'} ${content.access !== 'free' ? `<span class="premium-badge">${content.access === 'premium' ? 'Premium' : 'Buy'}</span>` : ''}</h3>
                            <p><strong>Category: ${content.category || 'N/A'}</strong></p> <!-- NEW: Show category -->
                            <p>${content.description || 'No description'}</p>
                            <div class="action-buttons">
                                <button class="btn btn-primary" onclick="editContent('${child.key}')">Edit</button>
                                <button class="btn btn-outline" onclick="deleteContent('${child.key}')">Delete</button>
                            </div>
                        </div>
                    `;
                    adminContentGrid.appendChild(card);
                });
            });
        }

        // Add/Edit Content
        addContentBtn.addEventListener('click', () => {
            contentForm.reset();
            contentForm.dataset.editId = '';
            contentPriceContainer.style.display = 'none';
            quizFields.style.display = 'none'; 
            document.getElementById('contentType').value = 'video';
            contentUrlInput.required = true; 
            contentFormContainer.style.display = 'block';
        });

        cancelContent.addEventListener('click', () => contentFormContainer.style.display = 'none');

        contentForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const title = document.getElementById('contentTitle').value.trim();
            const category = document.getElementById('contentCategory').value; // NEW: Get category
            const type = document.getElementById('contentType').value;
            const url = contentUrlInput.value.trim();
            const description = document.getElementById('contentDescription').value.trim();
            const access = document.getElementById('contentAccess').value;
            const price = parseFloat(document.getElementById('contentPrice').value) || null;

            if (!title || !category) { alert('Title and Category are required.'); return; }
            if (type !== 'quiz' && !url) { alert('URL is required for Videos and Notes.'); return; }
            if ((access === 'premium' || access === 'buy') && (!price || price <= 0)) { alert('Price is required for Premium/Buy content.'); return; }

            const data = { title, category, type, description: description || null, access, price }; // NEW: Add category to data

            if (type === 'quiz') {
                const question = document.getElementById('quizQuestion').value.trim();
                const options = [
                    document.getElementById('quizOption1').value.trim(),
                    document.getElementById('quizOption2').value.trim(),
                    document.getElementById('quizOption3').value.trim(),
                    document.getElementById('quizOption4').value.trim()
                ].filter(opt => opt);
                const correctAnswer = document.getElementById('quizCorrectAnswer').value.trim();
                if (!url && (!question || options.length < 2 || !correctAnswer)) {
                    alert('For a Quiz, provide either a URL or a full Question, Options, and Correct Answer.'); return;
                }
                if (question) {
                    data.question = question; data.options = options; data.correctAnswer = correctAnswer;
                }
                data.url = url || null;
            } else { data.url = url; }

            const editId = contentForm.dataset.editId;
            const contentRef = editId ? db.ref('content/' + editId) : db.ref('content').push();
            contentRef.set(data)
                .then(() => alert(`Content ${editId ? 'updated' : 'added'} successfully!`))
                .catch(error => alert('Error: ' + error.message));
            
            contentFormContainer.style.display = 'none';
        });

        function editContent(id) {
            db.ref('content/' + id).once('value').then(snap => {
                const content = snap.val();
                document.getElementById('contentTitle').value = content.title || '';
                document.getElementById('contentCategory').value = content.category || '+2'; // NEW
                document.getElementById('contentType').value = content.type || 'video';
                contentUrlInput.value = content.url || '';
                document.getElementById('contentDescription').value = content.description || '';
                document.getElementById('contentAccess').value = content.access || 'free';
                document.getElementById('contentPrice').value = content.price || '';
                
                contentPriceContainer.style.display = (content.access !== 'free') ? 'block' : 'none';
                quizFields.style.display = content.type === 'quiz' ? 'block' : 'none';

                if (content.type === 'quiz') {
                    document.getElementById('quizQuestion').value = content.question || '';
                    document.getElementById('quizOption1').value = content.options?.[0] || '';
                    document.getElementById('quizOption2').value = content.options?.[1] || '';
                    document.getElementById('quizOption3').value = content.options?.[2] || '';
                    document.getElementById('quizOption4').value = content.options?.[3] || '';
                    document.getElementById('quizCorrectAnswer').value = content.correctAnswer || '';
                }

                contentForm.dataset.editId = id;
                contentFormContainer.style.display = 'block';
            });
        }

        function deleteContent(id) { if (confirm('Delete content?')) db.ref('content/' + id).remove().then(() => alert('Content deleted!')); }

        // Load Content for all users
        function loadContent(isLoggedIn, isPremium, purchasedVideos = {}, favorites = {}, category) {
            document.getElementById('content').style.display = 'block';

            const contentRef = db.ref('content');
            // NEW: Efficiently filter by category on the server
            contentRef.orderByChild('category').equalTo(category).on('value', snapshot => {
                videoContentGrid.innerHTML = '';
                notesContentGrid.innerHTML = '';
                quizContentGrid.innerHTML = '';

                const videoFragment = document.createDocumentFragment();
                const notesFragment = document.createDocumentFragment();
                const quizFragment = document.createDocumentFragment();
                
                let hasContent = false;
                if (snapshot.exists()) {
                    snapshot.forEach(child => {
                        hasContent = true;
                        const content = child.val();
                        const contentId = child.key;
                        const card = createContentCard(content, contentId, isLoggedIn, isPremium, purchasedVideos, favorites);

                        if (content.type === 'video') videoFragment.appendChild(card);
                        else if (content.type === 'note') notesFragment.appendChild(card);
                        else if (content.type === 'quiz') quizFragment.appendChild(card);
                    });
                }
                
                if(!hasContent) {
                    const noContentMsg = `<p class="text-center" style="grid-column: 1 / -1;">No content found for the ${category} section. Check back soon!</p>`;
                    videoContentGrid.innerHTML = noContentMsg;
                    notesContentGrid.innerHTML = noContentMsg;
                    quizContentGrid.innerHTML = noContentMsg;
                } else {
                    videoContentGrid.appendChild(videoFragment);
                    notesContentGrid.appendChild(notesFragment);
                    quizContentGrid.appendChild(quizFragment);
                }
            });
        }

        function createContentCard(content, contentId, isLoggedIn, isPremium, purchasedVideos, favorites) {
            const card = document.createElement('div');
            card.className = 'content-card';
            
            let actionButton = '', badge = '', favoriteButton = '';

            if (isLoggedIn) {
                const isFavorited = favorites && favorites[contentId];
                favoriteButton = `<button class="favorite-btn ${isFavorited ? 'favorited' : ''}" onclick="toggleFavorite('${contentId}')"><i class="${isFavorited ? 'fas' : 'far'} fa-heart"></i></button>`;
            }

            let iconClass = 'fas fa-question';
            if (content.type === 'video') iconClass = 'fas fa-video';
            else if (content.type === 'note') iconClass = 'fas fa-file-pdf';

            if (content.access === 'free') {
                actionButton = createActionButton(content, contentId);
            } else if (content.access === 'premium') {
                badge = `<span class="premium-badge">Premium</span>`;
                if (isLoggedIn && isPremium) actionButton = createActionButton(content, contentId);
                else if (isLoggedIn && !isPremium) actionButton = `<button class="btn btn-primary" onclick="openPremiumModal()">Go Premium</button>`;
                else actionButton = `<button class="btn btn-primary" onclick="openLoginRegisterModal('login')">Login to View</button>`; 
            } else if (content.access === 'buy') {
                badge = `<span class="premium-badge">Buy (â‚¹${content.price || 0})</span>`;
                if (isLoggedIn && purchasedVideos && purchasedVideos[contentId]) actionButton = createActionButton(content, contentId);
                else if (isLoggedIn) actionButton = `<button class="btn btn-primary" onclick="openBuyModal('video', '${content.title}', '${content.price || 0}', '${contentId}')">Buy Now</button>`; 
                else actionButton = `<button class="btn btn-primary" onclick="openLoginRegisterModal('login')">Login to Buy</button>`; 
            }
            
            card.innerHTML = `
                <div class="content-thumb"><i class="${iconClass}"></i></div>
                <div class="content-info">
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <h3 style="margin-right: 1rem;">${content.title || 'N/A'} ${badge}</h3>
                        ${favoriteButton}
                    </div>
                    <p>${content.description || 'No description provided.'}</p>
                    ${actionButton}
                </div>`;
            return card;
        }
        
        function createActionButton(content, contentId) {
            if (content.type === 'quiz') {
                if (content.question) return `<button class="btn btn-primary" onclick="openQuizModal('${contentId}')">Start Quiz</button>`;
                if (content.url) return `<button class="btn btn-primary" onclick="openContentDisplayModal('${content.url}', 'quiz', '${content.title || "Quiz"}')">View Quiz</button>`;
                return `<button class="btn btn-outline" disabled>No Quiz Content</button>`;
            } else {
                return `<button class="btn btn-primary" onclick="openContentDisplayModal('${content.url}', '${content.type}', '${content.title || "Content"}')">${content.type === 'video' ? 'Watch Now' : 'View Note'}</button>`;
            }
        }

        function toggleFavorite(contentId) {
            const user = auth.currentUser;
            if (!user) return alert('Please log in to manage favorites.');
            const favoriteRef = db.ref(`users/${user.uid}/favorites/${contentId}`);
            favoriteRef.once('value', snapshot => {
                if (snapshot.exists()) favoriteRef.remove();
                else favoriteRef.set(true);
            });
        }

        function openLoginRegisterModal(tab = 'login') {
            authModal.style.display = 'flex';
            if (tab === 'login') showLoginTab.click(); else showRegisterTab.click();
        }

        function openBuyModal(type, title, price, contentId = null) {
            currentPaymentType = type;
            buyModalTitle.textContent = `${type === 'video' ? 'Buy Video: ' : 'Purchase: '}${title}`;
            itemPriceToBuy.textContent = price;
            currentVideoToBuy = { id: contentId, title, price };
            videoBuyModal.style.display = 'flex';
        }

        function openPremiumModal() {
            premiumModal.style.display = 'flex';
            db.ref('plans').once('value').then(snap => {
                const plans = snap.val();
                const defaultPlanKey = plans ? Object.keys(plans)[0] : null;
                displayPremiumAmount.textContent = (plans && defaultPlanKey) ? plans[defaultPlanKey].price : '100';
            });
        }
        
        function getEmbeddableUrl(originalUrl) {
            try {
                // Handle standard YouTube URLs
                if (originalUrl.includes("youtube.com/watch")) {
                    const videoId = new URL(originalUrl).searchParams.get("v");
                    return `https://www.youtube.com/embed/${videoId}?autoplay=1`;
                }
                // Handle short YouTube URLs
                if (originalUrl.includes("youtu.be/")) {
                    const videoId = new URL(originalUrl).pathname.slice(1);
                    return `https://www.youtube.com/embed/${videoId}?autoplay=1`;
                }
                // Handle YouTube Shorts URLs
                if (originalUrl.includes("youtube.com/shorts/")) {
                    const videoId = originalUrl.split('/shorts/')[1].split('?')[0];
                    return `https://www.youtube.com/embed/${videoId}?autoplay=1`;
                }
                // Handle Google Drive URLs for previewing
                if (originalUrl.includes("drive.google.com/file/d/")) {
                    const fileId = originalUrl.split('/d/')[1].split('/')[0];
                    return `https://drive.google.com/file/d/${fileId}/preview`;
                }
                // Handle Vimeo URLs
                if (originalUrl.includes("vimeo.com/")) {
                    const videoId = new URL(originalUrl).pathname.slice(1);
                    return `https://player.vimeo.com/video/${videoId}?autoplay=1`;
                }
            } catch (e) {
                console.error("Error parsing URL, returning original:", originalUrl, e);
                return originalUrl;
            }
            // If no special case matches, return the original URL.
            return originalUrl;
        }

        // ===================================================================
        // FIXED AND ENHANCED FUNCTION: `openContentDisplayModal`
        // This function now robustly handles all link types, ensuring content
        // is always accessible, either via embedding or a new tab.
        // ===================================================================
        function openContentDisplayModal(url, type, title) {
            contentDisplayModalTitle.textContent = title;
            contentIframeWrapper.innerHTML = ''; // Clear previous content
            
            if (!url) {
                contentIframeWrapper.innerHTML = `<div class="fallback-content"><h4>Content Not Available</h4><p>The link for this content is missing.</p></div>`;
                contentDisplayModal.style.display = 'flex';
                return;
            }

            // Function to show fallback message and provide a clickable link
            const showFallback = (originalUrl) => {
                contentIframeWrapper.innerHTML = `
                    <div class="fallback-content">
                        <h4>Content Opened in a New Tab</h4>
                        <p>This content couldn't be displayed here directly, so we've opened it for you in a new browser tab.</p>
                        <p style="margin-top: 1rem;">If the new tab didn't open, please click the button below.</p>
                        <button class="btn btn-primary" style="margin-top: 1rem;" onclick="window.open('${originalUrl}', '_blank', 'noopener,noreferrer')">Open Content</button>
                    </div>
                `;
            };

            // --- Proactive Checks for Problematic Content ---
            // PDFs and Google Docs/Sheets/Slides are best viewed in a new tab.
            if (/\.(pdf)$/i.test(url) || url.includes("docs.google.com")) {
                window.open(url, '_blank', 'noopener,noreferrer');
                showFallback(url);
                contentDisplayModal.style.display = 'flex';
                return;
            }

            // --- Attempt to display other content types directly ---
            // 1. Direct media files (images, videos)
            if (/\.(mp4|webm|ogg)$/i.test(url)) {
                contentIframeWrapper.innerHTML = `<video src="${url}" controls autoplay style="background-color: black;"></video>`;
            } else if (/\.(jpe?g|png|gif|webp|svg)$/i.test(url)) {
                contentIframeWrapper.innerHTML = `<img src="${url}" alt="${title}">`;
            } else {
                // 2. For everything else, attempt to embed in an Iframe with a reliable fallback
                const embeddableUrl = getEmbeddableUrl(url);
                contentIframeWrapper.innerHTML = `<iframe src="${embeddableUrl}" frameborder="0" allow="autoplay; fullscreen" allowfullscreen></iframe>`;
                
                const iframe = contentIframeWrapper.querySelector('iframe');

                // The 'onerror' event is our fallback. It triggers if the iframe content is blocked by security policies like X-Frame-Options.
                iframe.onerror = () => {
                    window.open(url, '_blank', 'noopener,noreferrer');
                    showFallback(url);
                };
            }
            
            contentDisplayModal.style.display = 'flex';
        }


        async function openQuizModal(quizId) {
            const quizSnap = await db.ref('content/' + quizId).once('value');
            currentQuizData = quizSnap.val(); currentQuizId = quizId;
            if (!currentQuizData || !currentQuizData.question) return alert('Quiz not configured.');
            quizQuestionContainer.style.display = 'block'; quizFeedback.style.display = 'none';
            submitQuizAnswerBtn.style.display = 'block'; closeQuizFeedbackBtn.style.display = 'none';
            quizModalTitle.textContent = currentQuizData.title || 'Quiz';
            quizQuestionText.textContent = currentQuizData.question;
            quizOptions.innerHTML = '';
            currentQuizData.options.forEach(option => {
                quizOptions.innerHTML += `<label class="quiz-option"><input type="radio" name="quizOption" value="${option}">${option}</label>`;
            });
            quizModal.style.display = 'flex';
        }

        submitQuizAnswerBtn.addEventListener('click', () => {
            const selectedOption = document.querySelector('input[name="quizOption"]:checked');
            if (!selectedOption) return alert('Please select an answer!');
            quizQuestionContainer.style.display = 'none'; quizFeedback.style.display = 'block';
            submitQuizAnswerBtn.style.display = 'none'; closeQuizFeedbackBtn.style.display = 'block';
            if (selectedOption.value === currentQuizData.correctAnswer) {
                quizFeedback.className = 'quiz-feedback correct';
                quizFeedback.innerHTML = 'Congratulations! Correct!';
                const user = auth.currentUser;
                if(user) db.ref(`users/${user.uid}/name`).once('value').then(nameSnap => {
                    db.ref('topScorer').set({ userName: nameSnap.val() || 'Anonymous', quizTitle: currentQuizData.title || 'a quiz' });
                });
            } else {
                quizFeedback.className = 'quiz-feedback incorrect';
                quizFeedback.innerHTML = `Incorrect. Correct answer: <strong>${currentQuizData.correctAnswer}</strong>.`;
            }
        });

        closeQuizFeedbackBtn.addEventListener('click', () => quizModal.style.display = 'none');

        function loadNotificationsCount() {
            const notificationsRef = db.ref('notifications');
            notificationsRef.on('value', snap => {
                const count = snap.numChildren();
                notificationCount.textContent = count;
                dropdownNotificationCount.textContent = count;
                notificationBell.style.display = (count > 0 && auth.currentUser) ? 'flex' : 'none';
            });
            notificationsRef.orderByChild('date').startAt(Date.now()).on('child_added', snap => {
                const notif = snap.val();
                if (notif.imageUrl) showImageNotification(notif); else showTextNotification(notif);
            });
        }
        
        function showNotification(notification, isImage = false) {
             const toastId = 'toast-' + Date.now();
            const toast = document.createElement('div');
            toast.className = 'notification-toast';
            toast.id = toastId;
            let iconHtml = isImage ? `<img src="${notification.imageUrl}" alt="${notification.title}">` : `<div class="toast-icon"><i class="fas fa-info-circle"></i></div>`;
            toast.innerHTML = `${iconHtml}<div class="notification-toast-content"><h4>${notification.title}</h4><p>${notification.message}</p></div><button class="toast-close-btn" onclick="document.getElementById('${toastId}').remove()">&times;</button>`;
            notificationToastContainer.appendChild(toast);
            setTimeout(() => toast.classList.add('show'), 100);
            setTimeout(() => { toast.classList.remove('show'); setTimeout(() => toast.remove(), 500); }, 10000);
        }

        function showImageNotification(notification) { showNotification(notification, true); }
        function showTextNotification(notification) { showNotification(notification, false); }

        function loadAdminPlans() {
            db.ref('plans').on('value', snapshot => {
                plansTableBody.innerHTML = '';
                if (!snapshot.exists()) return;
                snapshot.forEach(child => {
                    const plan = child.val();
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${plan.name || 'N/A'}</td><td>â‚¹${plan.price || '0'}</td><td>${plan.description || 'N/A'}</td>
                        <td><button class="btn btn-primary" onclick="editPlan('${child.key}')">Edit</button><button class="btn btn-outline" onclick="deletePlan('${child.key}')">Delete</button></td>
                    `;
                    plansTableBody.appendChild(row);
                });
            });
        }
        
        addPlanBtn.addEventListener('click', () => { planForm.reset(); planForm.dataset.editId = ''; planFormContainer.style.display = 'block'; });
        cancelPlan.addEventListener('click', () => planFormContainer.style.display = 'none');
        planForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('planName').value.trim(); const price = parseFloat(document.getElementById('planPrice').value); const description = document.getElementById('planDescription').value.trim();
            if (!name || isNaN(price) || price <= 0) return alert('Name and valid price are required.');
            const data = { name, price, description: description || null }; const editId = planForm.dataset.editId;
            if (editId) db.ref('plans/' + editId).update(data).then(() => alert('Plan updated!'));
            else db.ref('plans').push(data).then(() => alert('Plan added!'));
            planFormContainer.style.display = 'none';
        });

        function editPlan(id) {
            db.ref('plans/' + id).once('value').then(snap => {
                const p = snap.val(); document.getElementById('planName').value = p.name || ''; document.getElementById('planPrice').value = p.price || ''; document.getElementById('planDescription').value = p.description || '';
                planForm.dataset.editId = id; planFormContainer.style.display = 'block';
            });
        }
        function deletePlan(id) { if (confirm('Delete this plan?')) db.ref('plans/' + id).remove().then(() => alert('Plan deleted!')); }
        
        function loadAdminBanners() {
            db.ref('banners').on('value', snapshot => {
                bannersTableBody.innerHTML = ''; if (!snapshot.exists()) return;
                snapshot.forEach(child => {
                    const b = child.val(); const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${b.title || 'N/A'}</td><td><img src="${b.imageUrl}" style="width: 100px;"></td><td>${b.buttonText || 'N/A'}</td><td>${b.startDate || 'N/A'} to ${b.endDate || 'N/A'}</td>
                        <td><button class="btn btn-primary" onclick="editBanner('${child.key}')">Edit</button><button class="btn btn-outline" onclick="deleteBanner('${child.key}')">Delete</button></td>
                    `;
                    bannersTableBody.appendChild(row);
                });
            });
        }
        addBannerBtn.addEventListener('click', () => { bannerForm.reset(); bannerForm.dataset.editId = ''; bannerFormContainer.style.display = 'block'; });
        cancelBanner.addEventListener('click', () => bannerFormContainer.style.display = 'none');
        bannerForm.addEventListener('submit', (e) => {
            e.preventDefault(); const title = document.getElementById('bannerTitle').value.trim(); const imageUrl = document.getElementById('bannerImageUrl').value.trim();
            if (!title || !imageUrl) return alert('Title and Image URL are required.');
            const data = { title, imageUrl, description: document.getElementById('bannerDescription').value.trim() || null, buttonText: document.getElementById('bannerButtonText').value.trim() || null, buttonUrl: document.getElementById('bannerButtonUrl').value.trim() || null, startDate: document.getElementById('bannerStartDate').value || null, endDate: document.getElementById('bannerEndDate').value || null };
            const editId = bannerForm.dataset.editId;
            if (editId) db.ref('banners/' + editId).update(data).then(() => alert('Banner updated!'));
            else db.ref('banners').push(data).then(() => alert('Banner added!'));
            bannerFormContainer.style.display = 'none';
        });
        function editBanner(id) {
            db.ref('banners/' + id).once('value').then(snap => {
                const b = snap.val(); document.getElementById('bannerTitle').value = b.title || ''; document.getElementById('bannerDescription').value = b.description || ''; document.getElementById('bannerImageUrl').value = b.imageUrl || '';
                document.getElementById('bannerButtonText').value = b.buttonText || ''; document.getElementById('bannerButtonUrl').value = b.buttonUrl || ''; document.getElementById('bannerStartDate').value = b.startDate || ''; document.getElementById('bannerEndDate').value = b.endDate || '';
                bannerForm.dataset.editId = id; bannerFormContainer.style.display = 'block';
            });
        }
        function deleteBanner(id) { if (confirm('Delete banner?')) db.ref('banners/' + id).remove().then(() => alert('Banner deleted!')); }

        function loadAdminGallery() {
            db.ref('gallery').on('value', snapshot => {
                galleryTableBody.innerHTML = ''; if (!snapshot.exists()) return;
                snapshot.forEach(child => {
                    const item = child.val(); const row = document.createElement('tr');
                    row.innerHTML = `<td>${item.title}</td><td>${item.type}</td><td><a href="${item.url}" target="_blank">View</a></td><td><button class="btn btn-primary" onclick="editGalleryItem('${child.key}')">Edit</button><button class="btn btn-outline" onclick="deleteGalleryItem('${child.key}')">Delete</button></td>`;
                    galleryTableBody.appendChild(row);
                });
            });
        }
        addGalleryItemBtn.addEventListener('click', () => { galleryForm.reset(); galleryForm.dataset.editId = ''; galleryFormContainer.style.display = 'block'; });
        cancelGalleryItem.addEventListener('click', () => galleryFormContainer.style.display = 'none');
        galleryForm.addEventListener('submit', (e) => {
            e.preventDefault(); const title = document.getElementById('galleryItemTitle').value.trim(); const type = document.getElementById('galleryItemType').value; const url = document.getElementById('galleryItemUrl').value.trim();
            if (!title || !type || !url) return alert('All fields are required.');
            const data = { title, type, url, description: document.getElementById('galleryItemDescription').value.trim() || null };
            const editId = galleryForm.dataset.editId;
            if (editId) db.ref('gallery/' + editId).update(data).then(() => alert('Gallery item updated!'));
            else db.ref('gallery').push(data).then(() => alert('Gallery item added!'));
            galleryFormContainer.style.display = 'none';
        });
        function editGalleryItem(id) {
            db.ref('gallery/' + id).once('value').then(snap => {
                const i = snap.val(); document.getElementById('galleryItemTitle').value = i.title || ''; document.getElementById('galleryItemDescription').value = i.description || ''; document.getElementById('galleryItemType').value = i.type || 'photo'; document.getElementById('galleryItemUrl').value = i.url || '';
                galleryForm.dataset.editId = id; galleryFormContainer.style.display = 'block';
            });
        }
        function deleteGalleryItem(id) { if (confirm('Delete gallery item?')) db.ref('gallery/' + id).remove().then(() => alert('Item deleted!')); }

        function loadGallery() {
            db.ref('gallery').on('value', snapshot => {
                galleryContentGrid.innerHTML = ''; if (!snapshot.exists()) return;
                snapshot.forEach(child => {
                    const item = child.val(); const card = document.createElement('div'); card.className = 'content-card';
                    card.innerHTML = `<div class="content-thumb"><i class="fas fa-${item.type === 'video' ? 'video' : 'image'}"></i></div><div class="content-info"><h3>${item.title}</h3><p>${item.description || ''}</p><button class="btn btn-primary" onclick="openContentDisplayModal('${item.url}', '${item.type}', '${item.title}')">View</button></div>`;
                    galleryContentGrid.appendChild(card);
                });
            });
        }

        async function loadAdminSettings() {
            const settings = (await db.ref('settings').once('value')).val() || {};
            adminVerifyBadgePrice.value = settings.adminVerifyBadgePrice || ''; displayTotalUsersCountInput.value = settings.displayTotalUsersCount || ''; displayUserNamesInput.value = (settings.displayUserNames || []).join(', ');
            settingsAboutUsText.value = settings.aboutUsText || ''; settingsSugamEmail.value = settings.contact?.sugamEmail || ''; settingsDeveloperEmail.value = settings.contact?.developerEmail || '';
            settingsYoutubeLink.value = settings.socialLinks?.youtube || ''; settingsInstagramLink.value = settings.socialLinks?.instagram || ''; settingsFacebookLink.value = settings.socialLinks?.facebook || ''; settingsTwitterLink.value = settings.socialLinks?.twitter || '';
        }

        generalSettingsForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const settingsData = {
                adminVerifyBadgePrice: parseFloat(adminVerifyBadgePrice.value) || null,
                displayTotalUsersCount: displayTotalUsersCountInput.value.trim() || null,
                displayUserNames: displayUserNamesInput.value.split(',').map(n => n.trim()).filter(Boolean),
                aboutUsText: settingsAboutUsText.value.trim() || null,
                contact: { sugamEmail: settingsSugamEmail.value.trim() || null, developerEmail: settingsDeveloperEmail.value.trim() || null },
                socialLinks: { youtube: settingsYoutubeLink.value.trim() || null, instagram: settingsInstagramLink.value.trim() || null, facebook: settingsFacebookLink.value.trim() || null, twitter: settingsTwitterLink.value.trim() || null }
            };
            await db.ref('settings').update(settingsData);
            alert('Settings saved!'); loadDynamicUserDisplay(); renderFooter();
        });

        async function renderFooter() {
            const settings = (await db.ref('settings').once('value')).val() || {};
            footerAboutUsText.textContent = settings.aboutUsText || 'Default about text.';
            footerSugamEmail.textContent = settings.contact?.sugamEmail || 'N/A';
            footerDeveloperEmail.textContent = settings.contact?.developerEmail || 'N/A';
            const updateLink = (el, url) => { el.style.display = url ? 'inline-block' : 'none'; if(url) el.href = url; };
            updateLink(footerYoutubeLink, settings.socialLinks?.youtube); updateLink(footerInstagramLink, settings.socialLinks?.instagram); updateLink(footerFacebookLink, settings.socialLinks?.facebook); updateLink(footerTwitterLink, settings.socialLinks?.twitter);
        }

        let currentDynamicUserNameIndex = 0; let rotationTimeout; let barDisplayTimeout;
        async function loadDynamicUserDisplay() {
            const settings = (await db.ref('settings').once('value')).val() || {};
            userNotificationCount.textContent = settings.displayTotalUsersCount || '0';
            const realUserNames = []; (await db.ref('users').once('value')).forEach(child => realUserNames.push(child.val().name));
            displayedUserNames = [...new Set([...realUserNames, ...(settings.displayUserNames || [])])];
            clearInterval(rotationTimeout); clearTimeout(barDisplayTimeout); clearInterval(userNotificationBarInterval);
            userNotificationBar.classList.remove('show');
            if (displayedUserNames.length > 0) {
                const showAndRotateBar = () => {
                    userNotificationBar.style.display = 'flex'; userNotificationBar.classList.add('show');
                    rotationTimeout = setInterval(() => {
                        userNotificationName.classList.remove('slide-in-out'); void userNotificationName.offsetWidth; userNotificationName.classList.add('slide-in-out');
                        setTimeout(() => {
                            currentDynamicUserNameIndex = (currentDynamicUserNameIndex + 1) % displayedUserNames.length;
                            userNotificationName.textContent = displayedUserNames[currentDynamicUserNameIndex];
                        }, 500);
                    }, 5000);
                    barDisplayTimeout = setTimeout(() => {
                        userNotificationBar.classList.remove('show'); clearInterval(rotationTimeout);
                    }, 7000);
                };
                userNotificationBarInterval = setInterval(showAndRotateBar, 20000);
            }
        }

        async function fetchInstagramFollowers() {
            if (!instagramFollowerCount) return;
            instagramFollowerCount.innerHTML = '<span class="loading"></span>';
            await new Promise(resolve => setTimeout(resolve, 1500));
            instagramFollowerCount.innerHTML = "1M+";
        }
        function followUser() { window.open('https://www.instagram.com/snr__27?igsh=MXI4YXd5NnIxMDAzcw==', '_blank'); }
        function closeInstagramPopup() { instagramPopupModal.style.display = 'none'; clearTimeout(popupAutoCloseTimer); if (followerUpdateInterval) clearInterval(followerUpdateInterval); }
        function createParticles() {
            const pCont = instagramPopupModal.querySelector('#particles'); if (!pCont) return; pCont.innerHTML = '';
            for (let i = 0; i < 25; i++) {
                const p = document.createElement('div'); p.classList.add('particle');
                p.style.cssText = `width:${Math.random()*6+2}px;height:${Math.random()*6+2}px;left:${Math.random()*100}%;top:${Math.random()*100}%;animation-delay:${Math.random()*5}s;animation-duration:${Math.random()*4+5}s;background:${Math.random()>.5?'rgba(255,0,255,.6)':'rgba(0,255,255,.6)'};`;
                pCont.appendChild(p);
            }
        }
        function showInstagramPopup() {
            if (adminPanel.style.display === 'block') return;
            instagramPopupModal.style.display = 'flex';
            instagramPopupContainer.style.animation = 'none'; void instagramPopupContainer.offsetWidth;
            instagramPopupContainer.style.animation = 'fadeIn 0.8s ease-out, neonBorder 4s infinite alternate';
            createParticles(); fetchInstagramFollowers();
            popupAutoCloseTimer = setTimeout(() => {
                instagramPopupContainer.style.animation = 'fadeOut 0.5s forwards';
                setTimeout(closeInstagramPopup, 500);
            }, 10000);
        }
        instagramCloseIcon.addEventListener('click', (e) => { instagramPopupContainer.style.animation = 'fadeOut 0.5s forwards'; setTimeout(closeInstagramPopup, 500); });
        instagramCloseBtnInner.addEventListener('click', (e) => { instagramPopupContainer.style.animation = 'fadeOut 0.5s forwards'; setTimeout(closeInstagramPopup, 500); });
        instagramFollowBtn.addEventListener('click', (e) => { followUser(); instagramPopupContainer.style.animation = 'fadeOut 0.5s forwards'; setTimeout(closeInstagramPopup, 500); });
        document.addEventListener('DOMContentLoaded', () => { setTimeout(showInstagramPopup, 2000); });

        function googleTranslateElementInit() { new google.translate.TranslateElement({ pageLanguage: 'en', includedLanguages: 'en,or,hi,bn,te,ta', autoDisplay: false }, 'google_translate_element'); }
        document.getElementById('languageSelect').addEventListener('change', (e) => {
            const lang = e.target.value; document.documentElement.lang = lang;
            const translateEl = document.querySelector('.goog-te-combo'); if (translateEl) { translateEl.value = lang; translateEl.dispatchEvent(new Event('change')); }
        });

        function openMyPurchasesModal() {
            const user = auth.currentUser; if (!user) return;
            db.ref('payments').orderByChild('userId').equalTo(user.uid).on('value', snapshot => {
                purchasesTableBody.innerHTML = ''; if (!snapshot.exists()) return;
                snapshot.forEach(child => {
                    const p = child.val(); const row = document.createElement('tr');
                    row.innerHTML = `<td>${p.title||p.type}</td><td>â‚¹${p.amount}</td><td>${new Date(p.date).toLocaleDateString()}</td><td><span class="status-badge status-${p.status}">${p.status}</span></td>`;
                    purchasesTableBody.prepend(row);
                });
            });
            myPurchasesModal.style.display = 'flex';
        }
        async function openMyFavoritesModal() {
            const user = auth.currentUser; if (!user) return;
            favoritesContentGrid.innerHTML = '<p>Loading...</p>'; myFavoritesModal.style.display = 'flex';
            const userSnap = await db.ref(`users/${user.uid}`).once('value');
            const userData = userSnap.val(); const favorites = userData.favorites || {};
            const favoriteIds = Object.keys(favorites);
            if (favoriteIds.length === 0) { favoritesContentGrid.innerHTML = '<p>No favorites yet.</p>'; return; }
            const favoriteSnaps = await Promise.all(favoriteIds.map(id => db.ref(`content/${id}`).once('value')));
            favoritesContentGrid.innerHTML = '';
            favoriteSnaps.forEach(snap => {
                if (snap.exists()) favoritesContentGrid.appendChild(createContentCard(snap.val(), snap.key, true, userData.premium, userData.purchasedVideos, userData.favorites));
            });
        }
        
        // ===================================================================
        // FIXED AND ENHANCED FUNCTION: `loadTopScorer`
        // This function now uses better text and hides the banner automatically.
        // ===================================================================
        let topScorerTimeout; // Keep a reference to the timeout
        function loadTopScorer() {
            db.ref('topScorer').on('value', snapshot => {
                if (snapshot.exists()) {
                    const data = snapshot.val();
                    // Use more exciting and informative text
                    topScorerBanner.innerHTML = `<p>ðŸ† <strong>New High Score!</strong> <span>${data.userName}</span> just aced the "<strong>${data.quizTitle}</strong>" quiz! ðŸŽ‰</p>`;
                    
                    // Show the banner
                    topScorerBanner.style.display = 'block';
                    topScorerBanner.style.opacity = 1;

                    // Clear any previous timeout to ensure the new score banner stays for the full duration
                    clearTimeout(topScorerTimeout);

                    // Set a timeout to hide the banner after 15 seconds
                    topScorerTimeout = setTimeout(() => {
                        topScorerBanner.style.opacity = 0;
                        // Use another timeout to set display to 'none' after the fade-out transition
                        setTimeout(() => {
                           topScorerBanner.style.display = 'none';
                        }, 500); // This duration should match the transition duration in CSS
                    }, 15000); // 15 seconds
                } else {
                    topScorerBanner.style.display = 'none';
                }
            });
        }


        chatFab.addEventListener('click', () => { chatWidget.style.display = chatWidget.style.display === 'flex' ? 'none' : 'flex'; });
        closeChatWidget.addEventListener('click', () => { chatWidget.style.display = 'none'; });
        function initializeUserChat() {
            const user = auth.currentUser; if (!user) return;
            db.ref(`chats/${user.uid}/messages`).orderByChild('timestamp').on('value', snapshot => {
                chatMessagesContainer.innerHTML = '';
                if (snapshot.exists()) snapshot.forEach(child => renderChatMessage(child.val().sender, child.val().text, child.val().timestamp));
                else chatMessagesContainer.innerHTML = '<p>Start a conversation!</p>';
                chatMessagesContainer.scrollTop = chatMessagesContainer.scrollHeight;
            });
        }
        chatInputForm.addEventListener('submit', (e) => {
            e.preventDefault(); const user = auth.currentUser; const text = chatMessageInput.value.trim(); if (!user || !text) return;
            const timestamp = firebase.database.ServerValue.TIMESTAMP;
            db.ref(`chats/${user.uid}/messages`).push({ sender: 'user', text, timestamp });
            db.ref(`chats/${user.uid}/meta`).update({ lastMessage: text, lastTimestamp: timestamp, userName: user.displayName || user.email, hasUnreadAdminMessage: true });
            chatMessageInput.value = '';
        });
        function renderChatMessage(sender, text, timestamp, container = chatMessagesContainer) {
            const msgEl = document.createElement('div'); msgEl.className = `chat-message ${sender}`;
            msgEl.innerHTML = `<div>${text}</div><div class="chat-message-time">${new Date(timestamp).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</div>`;
            container.appendChild(msgEl);
        }

        function loadAdminChatList() {
            db.ref('chats').orderByChild('meta/lastTimestamp').on('value', async snapshot => {
                adminChatList.innerHTML = ''; if (!snapshot.exists()) return;
                const chatList = []; snapshot.forEach(child => chatList.push({ userId: child.key, ...child.val().meta }));
                chatList.reverse().forEach(chat => {
                    const itemEl = document.createElement('div'); itemEl.className = 'admin-chat-list-item'; itemEl.dataset.userId = chat.userId;
                    itemEl.innerHTML = `<strong>${chat.userName}</strong><span>${chat.lastMessage ? (chat.lastMessage.substring(0, 30) + '...') : 'N/A'}</span>`;
                    itemEl.addEventListener('click', () => openAdminChat(chat.userId, chat.userName));
                    adminChatList.appendChild(itemEl);
                });
            });
        }
        function openAdminChat(userId, userName) {
            currentAdminChatUserId = userId;
            document.querySelectorAll('.admin-chat-list-item').forEach(el => el.classList.toggle('active', el.dataset.userId === userId));
            adminChatWindow.innerHTML = `<div class="chat-widget-header"><span>Chat with ${userName}</span></div><div class="chat-messages" id="adminChatMessagesContainer"></div><form class="chat-input-form" id="adminChatInputForm"><input type="text" id="adminChatMessageInput" placeholder="Type reply..." required><button type="submit"><i class="fas fa-paper-plane"></i></button></form>`;
            const adminMessagesContainer = document.getElementById('adminChatMessagesContainer');
            db.ref(`chats/${userId}/messages`).orderByChild('timestamp').on('value', snapshot => {
                adminMessagesContainer.innerHTML = '';
                snapshot.forEach(child => renderChatMessage(child.val().sender, child.val().text, child.val().timestamp, adminMessagesContainer));
                adminMessagesContainer.scrollTop = adminMessagesContainer.scrollHeight;
            });
            document.getElementById('adminChatInputForm').addEventListener('submit', e => {
                e.preventDefault(); const text = document.getElementById('adminChatMessageInput').value.trim();
                if (!text || !currentAdminChatUserId) return;
                db.ref(`chats/${currentAdminChatUserId}/messages`).push({ sender: 'admin', text, timestamp: firebase.database.ServerValue.TIMESTAMP });
                db.ref(`chats/${currentAdminChatUserId}/meta`).update({ hasUnreadAdminMessage: false });
                document.getElementById('adminChatMessageInput').value = '';
            });
        }
        // Initialize
        updateUI(null);
    </script>
</body>
</html>
